<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plug & Abandonment Demo Course | The Brahan Engine</title>
    <meta name="description" content="Comprehensive Plug and Abandonment (P&A) training course covering regulatory frameworks, barrier systems, liability, and global best practices.">
    <link rel="icon" type="image/jpeg" href="assets/images/logo.jpg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg: #0b1220;
            --panel: #0f172a;
            --card: #1e293b;
            --border: #334155;
            --fg: #e2e8f0;
            --muted: #94a3b8;
            --accent: #14b8a6;
            --accent-hover: #2dd4bf;
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --secondary-color: #10b981;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --bg-light: #0f172a;
            --bg-white: #1e293b;
            --border-color: #334155;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --nav-bg: #0b1220;
            --nav-border: #334155;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg);
        }

        /* Unified Navigation */
        .unified-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(11,18,32,.98), rgba(15,23,42,.95));
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--nav-border);
        }
        .header-wrap {
            max-width: 1400px;
            margin: 0 auto;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .brand img {
            height: 40px;
            width: auto;
            border-radius: 8px;
        }
        .brand-text h1 {
            font-size: 1.25rem;
            font-weight: 800;
            color: white;
            letter-spacing: -0.025em;
        }
        .brand-text span {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        .main-nav {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .main-nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: #94a3b8;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .main-nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.05);
        }
        .main-nav-link.active {
            color: var(--accent);
            background: rgba(20, 184, 166, 0.15);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }
        .hero h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 12px;
        }
        .hero p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto 24px;
        }
        .hero-meta {
            display: flex;
            gap: 24px;
            justify-content: center;
            font-size: 0.95rem;
            opacity: 0.9;
        }
        .hero-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
        }
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .progress-title {
            font-weight: 700;
            font-size: 1.1rem;
        }
        .progress-percent {
            font-weight: 700;
            color: var(--accent);
            font-size: 1.2rem;
        }
        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--secondary-color));
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        /* Video Section */
        .video-section {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
        }
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .video-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        /* Module List */
        .modules-section {
            margin-bottom: 32px;
        }
        .module-card {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(37, 99, 235, 0.05), transparent);
            transition: left 0.5s;
        }
        .module-card:hover::before {
            left: 100%;
        }
        .module-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateX(8px) scale(1.01);
        }
        .module-card.completed {
            border-left-color: var(--success);
        }
        .module-card.completed:hover {
            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.2);
        }
        .module-card.in-progress {
            border-left-color: var(--warning);
            animation: pulse 3s infinite;
        }
        .module-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .module-card.locked:hover {
            transform: none;
        }
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .module-title-group {
            flex: 1;
        }
        .module-number {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }
        .module-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .module-duration {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        .module-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .module-status.completed {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }
        .module-status.in-progress {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        .module-status.locked {
            background: var(--bg-light);
            color: var(--text-secondary);
        }
        .module-description {
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.6;
        }
        .module-content {
            display: none;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            margin-top: 16px;
        }
        .module-content.active {
            display: block;
        }
        .key-points {
            margin-bottom: 16px;
        }
        .key-points h4 {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .key-points ul {
            margin-left: 20px;
            color: var(--text-secondary);
        }
        .key-points li {
            margin-bottom: 6px;
        }

        /* Quiz Section */
        .quiz-section {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
        }
        .quiz-title {
            font-weight: 700;
            margin-bottom: 16px;
        }
        .quiz-question {
            margin-bottom: 20px;
        }
        .quiz-question p {
            font-weight: 600;
            margin-bottom: 12px;
        }
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .quiz-option {
            padding: 12px;
            background: var(--bg-white);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quiz-option:hover {
            border-color: var(--accent);
        }
        .quiz-option.selected {
            border-color: var(--primary-color);
            background: rgba(37, 99, 235, 0.05);
        }
        .quiz-option.correct {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }
        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        /* Action Buttons */
        .module-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
            background: var(--border-color);
        }
        .btn-success {
            background: var(--success);
            color: white;
        }

        /* Related Resources */
        .resources-section {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-md);
        }
        .resources-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
        }
        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        .resource-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent);
            transition: all 0.2s;
        }
        .resource-card:hover {
            box-shadow: var(--shadow-sm);
        }
        .resource-card h4 {
            font-weight: 700;
            margin-bottom: 8px;
        }
        .resource-card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 12px;
        }
        .resource-link {
            color: var(--primary-color);
            font-weight: 600;
            text-decoration: none;
            font-size: 0.95rem;
        }
        .resource-link:hover {
            text-decoration: underline;
        }

        /* Certificate Section */
        .certificate-section {
            background: linear-gradient(135deg, var(--success) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            display: none;
        }
        .certificate-section.show {
            display: block;
        }
        .certificate-section h2 {
            font-size: 2rem;
            margin-bottom: 16px;
        }
        .certificate-section p {
            font-size: 1.1rem;
            opacity: 0.95;
            margin-bottom: 24px;
        }

        /* Interactive Elements */
        .interactive-section {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(20, 184, 166, 0.05));
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
        }

        /* Risk Cards (Module 1) */
        .risk-card {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        .risk-card * {
            cursor: pointer;
            pointer-events: none;
        }
        .risk-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(239, 68, 68, 0.1), transparent);
            transition: left 0.5s;
        }
        .risk-card:hover::before {
            left: 100%;
        }
        .risk-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.2);
            border-color: var(--danger);
        }
        .risk-card.active {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        /* Golden Rules (Module 7) */
        .golden-rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        .golden-rule-card {
            background: var(--bg-white);
            padding: 24px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid var(--border-color);
            text-align: center;
            user-select: none;
        }
        .golden-rule-card * {
            cursor: pointer;
            pointer-events: none;
        }
        .golden-rule-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: var(--shadow-lg);
            border-color: var(--success);
        }
        .golden-rule-card.active {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1));
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }
        .rule-number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--secondary-color));
            color: white;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }
        .golden-rule-card h4 {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        .golden-rule-card p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        .rule-application {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }
        .rule-application.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        .interactive-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .interactive-title::before {
            content: "ðŸŽ¯";
            font-size: 1.3rem;
        }

        /* Barrier Builder */
        .barrier-builder {
            display: flex;
            gap: 20px;
            margin-top: 16px;
        }
        .barrier-components {
            flex: 1;
            background: var(--bg-white);
            padding: 16px;
            border-radius: 8px;
            border: 2px dashed var(--border-color);
        }
        .barrier-preview {
            flex: 1;
            background: var(--bg-white);
            padding: 16px;
            border-radius: 8px;
            min-height: 300px;
            position: relative;
        }
        .component-item {
            background: var(--bg-light);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 4px solid var(--accent);
            cursor: move;
            transition: all 0.2s;
            user-select: none;
        }
        .component-item:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-sm);
        }
        .component-item.dragging {
            opacity: 0.5;
        }
        .barrier-layer {
            padding: 16px;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 2px dashed transparent;
            min-height: 60px;
            transition: all 0.2s;
        }
        .barrier-layer.drag-over {
            border-color: var(--accent);
            background: rgba(20, 184, 166, 0.1);
        }
        .barrier-layer.filled {
            border-style: solid;
            background: var(--bg-light);
        }
        .barrier-layer.cement {
            border-left-color: #94a3b8;
            background: linear-gradient(90deg, rgba(148, 163, 184, 0.2), transparent);
        }
        .barrier-layer.casing {
            border-left-color: #64748b;
            background: linear-gradient(90deg, rgba(100, 116, 139, 0.2), transparent);
        }
        .barrier-layer.formation {
            border-left-color: #78716c;
            background: linear-gradient(90deg, rgba(120, 113, 108, 0.2), transparent);
        }

        /* Regulatory Comparison */
        .reg-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        .reg-card {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            border-top: 4px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }
        .reg-card * {
            cursor: pointer;
            pointer-events: none;
        }
        .reg-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .reg-card.selected {
            border-top-color: var(--accent);
            background: rgba(20, 184, 166, 0.05);
            box-shadow: 0 0 15px rgba(20, 184, 166, 0.3);
        }
        .reg-card h5 {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        .reg-details {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
            display: none;
        }
        .reg-details.active {
            display: block;
            animation: slideDown 0.3s ease;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(20, 184, 166, 0.7);
                border-color: var(--accent);
            }
            50% {
                box-shadow: 0 0 0 15px rgba(20, 184, 166, 0);
                border-color: var(--warning);
            }
        }

        /* Enhanced Visual Animations */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes fillUp {
            from {
                transform: scaleY(0);
                transform-origin: bottom;
            }
            to {
                transform: scaleY(1);
                transform-origin: bottom;
            }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px rgba(20, 184, 166, 0.5),
                           0 0 10px rgba(20, 184, 166, 0.3);
            }
            50% {
                box-shadow: 0 0 20px rgba(20, 184, 166, 0.8),
                           0 0 30px rgba(20, 184, 166, 0.4);
            }
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes cardFlip {
            0% {
                transform: rotateY(0deg);
            }
            50% {
                transform: rotateY(90deg);
            }
            100% {
                transform: rotateY(0deg);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Visual Enhancement Classes */
        .success-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--success), var(--secondary-color));
            color: white;
            border-radius: 24px;
            font-weight: 700;
            animation: successPulse 1s ease infinite;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto;
        }

        .progress-ring-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--border-color);
            stroke-width: 8;
        }

        .progress-ring-fill {
            fill: none;
            stroke: url(#progress-gradient);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .visual-meter {
            height: 24px;
            background: linear-gradient(90deg,
                var(--success) 0%,
                var(--warning) 50%,
                var(--danger) 100%);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .visual-meter::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent);
            animation: shimmer 2s infinite;
        }

        .meter-indicator {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 100%;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: left 0.3s ease;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9999;
            animation: confetti-fall 3s linear forwards;
        }

        .interactive-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent);
            animation: fadeInUp 0.5s ease;
        }

        .card-3d {
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card-3d:hover {
            transform: rotateY(10deg) rotateX(10deg);
        }

        .glow-on-hover:hover {
            animation: glow 2s infinite;
        }

        .slide-in-left {
            animation: slideInLeft 0.5s ease;
        }

        .slide-in-right {
            animation: slideInRight 0.5s ease;
        }

        .fade-in-up {
            animation: fadeInUp 0.5s ease;
        }

        .bounce-in {
            animation: bounce 0.5s ease;
        }

        /* Global Standards Explorer */
        .standards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }
        .country-card {
            background: var(--bg-white);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        .country-card * {
            cursor: pointer;
            pointer-events: none;
        }
        .country-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(20, 184, 166, 0.1), transparent);
            transition: left 0.5s;
        }
        .country-card:hover::before {
            left: 100%;
        }
        .country-card:hover {
            border-color: var(--accent);
            transform: scale(1.08) rotate(2deg);
            box-shadow: 0 8px 25px rgba(20, 184, 166, 0.3);
        }
        .country-card.active {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }
        .country-flag {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        .country-name {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        .country-type {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Liability Timeline */
        .timeline-container {
            margin-top: 16px;
            position: relative;
            padding: 20px 0;
        }
        .timeline {
            position: relative;
            padding-left: 40px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, var(--accent), var(--warning));
        }
        .timeline-item {
            position: relative;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-white);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .timeline-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -33px;
            top: 20px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            border: 3px solid var(--bg-light);
            z-index: 1;
        }
        .timeline-year {
            font-weight: 700;
            color: var(--accent);
            font-size: 1.1rem;
            margin-bottom: 4px;
        }
        .timeline-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Financial Calculator */
        .calculator {
            background: var(--bg-white);
            padding: 20px;
            border-radius: 8px;
            margin-top: 16px;
        }
        .calc-input-group {
            margin-bottom: 16px;
        }
        .calc-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        .calc-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .calc-input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .calc-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border-color);
            outline: none;
            -webkit-appearance: none;
        }
        .calc-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }
        .calc-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
        }
        .calc-result {
            background: linear-gradient(135deg, var(--accent), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 16px;
        }
        .calc-result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 4px;
        }
        .calc-result-value {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Responsive Design */

        /* Tablet */
        @media (max-width: 1024px) {
            .container {
                padding: 32px 16px;
            }
            .video-section {
                padding: 24px 16px;
            }
            .resources-section {
                padding: 24px 16px;
            }
            .resource-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            /* Header */
            .header-wrap {
                flex-wrap: wrap;
                padding: 10px 12px;
            }
            .brand img {
                height: 32px;
            }
            .brand-text h1 {
                font-size: 1rem;
            }
            .brand-text span {
                font-size: 0.65rem;
            }
            .main-nav {
                width: 100%;
                order: 3;
                margin-top: 8px;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .main-nav-link {
                font-size: 0.8rem;
                padding: 6px 10px;
                white-space: nowrap;
            }

            /* Hero */
            .hero {
                padding: 40px 16px;
            }
            .hero h1 {
                font-size: 1.75rem;
                line-height: 1.3;
            }
            .hero p {
                font-size: 0.95rem;
                margin-bottom: 16px;
            }
            .hero-meta {
                flex-direction: column;
                gap: 8px;
                font-size: 0.85rem;
            }

            /* Container */
            .container {
                padding: 24px 12px;
            }

            /* Progress */
            .progress-container {
                padding: 16px;
                margin-bottom: 20px;
            }
            .progress-title {
                font-size: 1rem;
            }
            .progress-percent {
                font-size: 1.1rem;
            }

            /* Video */
            .video-section {
                padding: 20px 12px;
                margin-bottom: 20px;
            }
            .video-section h2 {
                font-size: 1.35rem;
                margin-bottom: 16px;
            }
            .video-info {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            /* Modules */
            .modules-section h2 {
                font-size: 1.35rem;
                margin-bottom: 16px;
            }
            .module-card {
                padding: 16px;
                margin-bottom: 12px;
            }
            .module-header {
                flex-direction: column;
                gap: 8px;
            }
            .module-number {
                font-size: 0.8rem;
            }
            .module-title {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            .module-duration {
                font-size: 0.8rem;
            }
            .module-status {
                align-self: flex-start;
                padding: 4px 10px;
                font-size: 0.8rem;
            }
            .module-description {
                font-size: 0.9rem;
            }

            /* Quiz */
            .quiz-section {
                padding: 16px;
            }
            .quiz-title {
                font-size: 1rem;
            }
            .quiz-question p {
                font-size: 0.95rem;
            }
            .quiz-option {
                padding: 10px;
                font-size: 0.9rem;
            }

            /* Buttons */
            .module-actions {
                flex-direction: column;
                gap: 8px;
            }
            .btn {
                width: 100%;
                justify-content: center;
                padding: 10px 20px;
                font-size: 0.9rem;
            }

            /* Resources */
            .resources-section {
                padding: 20px 12px;
                margin-bottom: 20px;
            }
            .resources-title {
                font-size: 1.35rem;
                margin-bottom: 16px;
            }
            .resource-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .resource-card {
                padding: 16px;
            }
            .resource-card h4 {
                font-size: 1rem;
            }
            .resource-card p {
                font-size: 0.875rem;
            }

            /* Certificate */
            .certificate-section {
                padding: 24px 16px;
            }
            .certificate-section h2 {
                font-size: 1.5rem;
            }
            .certificate-section p {
                font-size: 0.95rem;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .hero h1 {
                font-size: 1.5rem;
            }
            .hero p {
                font-size: 0.875rem;
            }
            .hero-meta-item {
                font-size: 0.8rem;
            }

            .module-title {
                font-size: 1rem;
            }

            .video-section h2,
            .modules-section h2,
            .resources-title {
                font-size: 1.25rem;
            }

            .main-nav-link span {
                display: none;
            }
            .main-nav-link {
                padding: 8px;
            }
        }

        /* Touch improvements for all mobile devices */
        @media (hover: none) and (pointer: coarse) {
            .module-card {
                -webkit-tap-highlight-color: transparent;
            }
            .btn {
                min-height: 44px;
            }
            .quiz-option {
                min-height: 44px;
            }
        }

        /* Before/After Slider */
        .before-after-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .before-after-slider {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        .before-image, .after-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
        }

        .before-image {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 50%, #78350f 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .after-image {
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 50%, #064e3b 100%);
            clip-path: inset(0 50% 0 0);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .slider-handle {
            position: absolute;
            top: 0;
            left: 50%;
            width: 4px;
            height: 100%;
            background: var(--accent);
            cursor: ew-resize;
            transform: translateX(-50%);
            z-index: 10;
        }

        .slider-handle::before {
            content: 'â¬Œ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #0b1220;
            font-weight: 900;
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.5);
        }

        .well-visual {
            position: relative;
            width: 120px;
            height: 300px;
            border: 3px solid currentColor;
            border-radius: 8px;
            margin: 20px auto;
        }

        .well-label {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .well-description {
            font-size: 0.9rem;
            text-align: center;
            max-width: 300px;
        }

        .before-content {
            color: var(--danger);
        }

        .after-content {
            color: var(--success);
        }

        .leak-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--danger);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .seal-indicator {
            position: absolute;
            width: 100%;
            background: var(--success);
            opacity: 0.8;
        }

        /* Well Depth Visualizer */
        .depth-visualizer {
            background: linear-gradient(180deg, #0ea5e9 0%, #1e293b 30%, #0f172a 70%, #78350f 100%);
            border-radius: 12px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }

        .depth-scale {
            position: relative;
            height: 500px;
            border-left: 4px solid var(--accent);
            margin: 0 auto;
            max-width: 600px;
        }

        .depth-marker {
            position: absolute;
            left: 0;
            width: 100%;
            padding: 12px 20px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid var(--accent);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(4px);
        }

        .depth-marker:hover {
            transform: translateX(10px);
            border-color: var(--accent-hover);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);
        }

        .depth-marker.active {
            background: rgba(20, 184, 166, 0.2);
            border-color: var(--accent-hover);
            transform: translateX(15px);
        }

        .depth-label {
            font-weight: 700;
            color: var(--accent);
            font-size: 1rem;
        }

        .depth-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .depth-info-panel,
        .depth-info {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .depth-info-panel.active,
        .depth-info.active {
            display: block;
        }

        .depth-info-panel h4,
        .depth-info h4 {
            color: var(--accent);
            margin-bottom: 12px;
        }

        /* Cement Volume Calculator */
        .cement-calculator {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 16px;
        }

        @media (max-width: 768px) {
            .cement-calculator {
                grid-template-columns: 1fr;
            }
        }

        .calculator-inputs {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .calc-input {
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .calc-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
        }

        .calc-input:hover {
            border-color: var(--accent);
        }

        .calculator-results {
            background: linear-gradient(135deg, var(--card) 0%, var(--bg) 100%);
            padding: 24px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.1);
        }

        .result-item {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 12px;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .result-item:hover {
            background: rgba(20, 184, 166, 0.1);
            transform: translateX(4px);
        }

        .result-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .result-value {
            color: var(--accent);
            font-size: 1.2rem;
            font-weight: bold;
            text-align: right;
        }

        .result-unit {
            color: var(--muted);
            font-size: 0.9rem;
            min-width: 100px;
        }

        /* P&A Decision Tree */
        .decision-tree {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .decision-tree-container {
            min-height: 300px;
            position: relative;
        }

        .decision-slide {
            display: none;
            animation: fadeInUp 0.5s ease;
        }

        .decision-slide.active {
            display: block;
        }

        .decision-question h4 {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .decision-btn {
            background: linear-gradient(135deg, var(--bg) 0%, var(--card) 100%);
            border: 2px solid var(--border);
            padding: 16px 20px;
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .decision-btn:hover {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--accent) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(20, 184, 166, 0.2);
        }

        .decision-result {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .decision-result.active {
            display: block;
        }

        .result-summary {
            background: var(--bg);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }

        .result-summary h5 {
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .result-summary p {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .result-summary ul {
            margin-left: 20px;
            margin-top: 8px;
            line-height: 1.8;
        }

        .decision-breadcrumb {
            margin-top: 20px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
            font-size: 0.9rem;
            min-height: 40px;
        }

        .requirement-item {
            background: rgba(20, 184, 166, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid var(--accent);
        }

        .cost-estimate {
            background: rgba(234, 179, 8, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            border-left: 3px solid var(--warning);
        }

        /* Barrier Sequence Builder */
        .sequence-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-top: 16px;
        }

        @media (max-width: 968px) {
            .sequence-builder {
                grid-template-columns: 1fr;
            }
        }

        .builder-controls {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .barrier-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .barrier-type-card {
            background: var(--bg);
            padding: 16px;
            border-radius: 10px;
            border: 2px solid var(--border);
            text-align: center;
            transition: all 0.3s;
        }

        .barrier-type-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(20, 184, 166, 0.1);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn-accent {
            background: var(--accent);
            color: var(--bg);
        }

        .btn-accent:hover {
            background: var(--primary-color);
        }

        .wellbore-visual {
            background: linear-gradient(180deg, #0ea5e9 0%, #1e293b 20%, #0f172a 80%, #78350f 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--accent);
        }

        .wellbore-container {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 10px;
            padding: 16px;
            backdrop-filter: blur(4px);
        }

        .depth-zone {
            margin-bottom: 16px;
            padding: 12px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            border-left: 3px solid var(--muted);
        }

        .zone-label {
            font-size: 0.9rem;
            color: var(--accent);
            margin-bottom: 8px;
            font-weight: bold;
        }

        .barrier-slot {
            min-height: 60px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .barrier-slot:empty::before {
            content: 'Empty - Add barrier';
        }

        .barrier-slot.filled {
            background: linear-gradient(135deg, rgba(20, 184, 166, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%);
            border: 2px solid var(--accent);
            border-style: solid;
        }

        .barrier-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: bold;
        }

        .barrier-item .icon {
            font-size: 1.5rem;
        }

        /* Pressure Test Simulator */
        .pressure-test-container {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 24px;
            margin-top: 16px;
        }

        @media (max-width: 968px) {
            .pressure-test-container {
                grid-template-columns: 1fr;
            }
        }

        .test-controls-panel {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .pressure-gauge-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .gauge-circle {
            width: 150px;
            height: 150px;
            margin: 0 auto 12px;
            border-radius: 50%;
            border: 8px solid var(--accent);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bg) 0%, var(--card) 100%);
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.3);
            transition: all 0.3s;
        }

        .gauge-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .gauge-unit {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .gauge-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .test-visualization-panel {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--accent);
        }

        .barrier-test-visual {
            min-height: 300px;
            position: relative;
            background: var(--bg);
            border-radius: 10px;
            padding: 20px;
        }

        .wellbore-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            height: 250px;
        }

        .formation-wall {
            width: 40px;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                #78350f,
                #78350f 10px,
                #92400e 10px,
                #92400e 20px
            );
            border: 2px solid #451a03;
        }

        .cement-plug {
            width: 120px;
            height: 100%;
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            border: 3px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s;
        }

        .cement-plug.under-pressure {
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.5);
            animation: pulse 2s infinite;
        }

        .plug-label {
            font-size: 0.75rem;
            color: var(--text-primary);
            text-align: center;
            font-weight: bold;
        }

        .pressure-arrows {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            gap: 100px;
            animation: fadeIn 0.5s;
        }

        .pressure-arrows .arrow {
            font-size: 1.2rem;
            color: var(--accent);
            font-weight: bold;
        }

        .leak-indicators {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .leak {
            position: absolute;
            font-size: 1.5rem;
            animation: leakFlow 1s ease-in-out infinite;
        }

        @keyframes leakFlow {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(10px); }
        }

        .test-progress {
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: var(--bg);
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, var(--primary-color) 100%);
            transition: width 0.5s linear;
            width: 0%;
        }

        /* Cost Breakdown Pie Chart */
        .cost-breakdown-container {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 24px;
            margin-top: 16px;
        }

        @media (max-width: 968px) {
            .cost-breakdown-container {
                grid-template-columns: 1fr;
            }
        }

        .pie-chart-section {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .pie-chart-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 24px;
        }

        .pie-chart {
            position: relative;
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: conic-gradient(
                #3b82f6 0% 30%,
                #10b981 30% 55%,
                #f59e0b 55% 75%,
                #8b5cf6 75% 85%,
                #ec4899 85% 95%,
                #14b8a6 95% 100%
            );
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.3s;
        }

        .pie-chart:hover {
            transform: scale(1.05);
        }

        .pie-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .center-label {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .center-sublabel {
            font-size: 0.75rem;
            color: var(--muted);
            margin-top: 4px;
        }

        .pie-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .legend-item:hover {
            background: rgba(20, 184, 166, 0.1);
            transform: translateX(4px);
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            flex-shrink: 0;
        }

        .legend-label {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .cost-detail-panel {
            background: linear-gradient(135deg, var(--card) 0%, var(--bg) 100%);
            padding: 24px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            min-height: 300px;
        }

        /* Reset Course Button */
        .btn-reset-course {
            margin-top: 24px;
            padding: 12px 24px;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            color: #ef4444;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-reset-course:hover {
            background: #ef4444;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-reset-course:active {
            transform: translateY(0);
        }

    </style>
</head>
<body>
    <!-- Navigation -->
    <header class="unified-header">
        <div class="header-wrap">
            <a href="index.html" class="brand">
                <img src="assets/images/logo.jpg" alt="WellTegra Logo">
                <div class="brand-text">
                    <h1>The Brahan Engine</h1>
                    <span>Stop Paying the NPT Tax</span>
                </div>
            </a>
            <nav class="main-nav">
                <a href="index.html" class="main-nav-link">Dashboard</a>
                <a href="sop-library.html" class="main-nav-link">SOP Library</a>
                <a href="equipment.html" class="main-nav-link">Equipment</a>
                <a href="intervention-guide.html" class="main-nav-link">Guide</a>
                <a href="pa-course.html" class="main-nav-link active">P&A Course</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>Plug & Abandonment Demo Course</h1>
        <p>Master the regulatory frameworks, technical barriers, and long-term liability considerations essential for safe and compliant well abandonment operations</p>
        <div class="hero-meta">
            <div class="hero-meta-item">
                <span>â±ï¸</span>
                <span>~12 minutes core content</span>
            </div>
            <div class="hero-meta-item">
                <span>ðŸ“š</span>
                <span>7 comprehensive modules</span>
            </div>
            <div class="hero-meta-item">
                <span>ðŸŽ¯</span>
                <span>Certificate of completion</span>
            </div>
        </div>
        <button onclick="resetCourseProgress()" class="btn-reset-course" title="Clear all progress and start over">
            ðŸ”„ Reset Course Progress
        </button>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Progress Tracker -->
        <div class="progress-container">
            <div class="progress-header">
                <div class="progress-title">Your Progress</div>
                <div class="progress-percent" id="progress-percent">0%</div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <!-- Video Section -->
        <div class="video-section">
            <h2 style="margin-bottom: 20px; font-size: 1.75rem;">Interactive Course Video</h2>
            <div style="background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(20, 184, 166, 0.1)); padding: 16px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid var(--accent);">
                <p style="margin: 0; font-weight: 600; color: var(--primary-color);">
                    ðŸŽ¯ Interactive Learning Mode: The video will pause at key moments for you to practice what you've learned!
                </p>
            </div>
            <div class="video-wrapper">
                <div id="youtube-player"></div>
            </div>

            <!-- Video Checkpoint Alert -->
            <div id="checkpoint-alert" style="display: none; margin-top: 16px; padding: 20px; background: linear-gradient(135deg, var(--warning), var(--accent)); color: white; border-radius: 8px; text-align: center;">
                <h3 style="margin-bottom: 12px; font-size: 1.3rem;">â¸ï¸ Checkpoint Reached!</h3>
                <p id="checkpoint-message" style="margin-bottom: 16px; font-size: 1.1rem;"></p>
                <p style="font-size: 0.95rem; opacity: 0.9;">Scroll down to complete the interactive exercise, then click Continue.</p>
                <button id="continue-btn" class="btn" style="background: white; color: var(--accent); margin-top: 12px; font-weight: 700;" onclick="continueVideo()" disabled>
                    âœ“ Complete Exercise First
                </button>
            </div>

            <div class="video-info" style="margin-top: 16px;">
                <div>
                    <strong>Duration:</strong> 11:45 | <strong>Checkpoints:</strong> 5 Interactive Elements
                </div>
                <div id="current-checkpoint" style="color: var(--text-secondary); font-size: 0.9rem;">
                    ðŸ“ Next checkpoint: Module 2 at 2:46
                </div>
            </div>
        </div>

        <!-- Course Modules -->
        <div class="modules-section">
            <h2 style="margin-bottom: 24px; font-size: 1.75rem;">Course Modules</h2>

            <!-- Module 1 -->
            <div class="module-card locked" data-module="1" onclick="toggleModule(1)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 1</div>
                        <div class="module-title">Introduction to P&A Importance</div>
                        <div class="module-duration">ðŸ“¹ Video: 00:00 - 01:50</div>
                    </div>
                    <div class="module-status" id="status-1">
                        <span>â­•</span>
                        <span>Not Started</span>
                    </div>
                </div>
                <div class="module-description">
                    Understanding why proper well abandonment is critical for environmental protection, public safety, and regulatory compliance.
                </div>
                <div class="module-content" id="content-1">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li>Wells at end of productive life cannot be simply left open</li>
                            <li>Severe risks include groundwater contamination, soil pollution, and greenhouse gas leaks</li>
                            <li>P&A permanently seals wells using specialized equipment</li>
                            <li>Primary goal: protect environment and public safety</li>
                            <li>Legal and regulatory obligations for operators</li>
                        </ul>
                    </div>

                    <!-- Interactive Environmental Risk Visualizer -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Environmental Risks of Abandoned Wells</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Click on each risk area to explore the environmental and safety consequences of improperly abandoned wells.</p>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
                            <div class="risk-card" onclick="event.stopPropagation(); selectRisk('groundwater')" data-risk="groundwater">
                                <div style="font-size: 3rem; text-align: center; margin-bottom: 8px;">ðŸ’§</div>
                                <h4 style="text-align: center; font-size: 1rem; margin-bottom: 8px;">Groundwater Contamination</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Click to explore</p>
                            </div>

                            <div class="risk-card" onclick="event.stopPropagation(); selectRisk('soil')" data-risk="soil">
                                <div style="font-size: 3rem; text-align: center; margin-bottom: 8px;">ðŸŒ±</div>
                                <h4 style="text-align: center; font-size: 1rem; margin-bottom: 8px;">Soil Pollution</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Click to explore</p>
                            </div>

                            <div class="risk-card" onclick="event.stopPropagation(); selectRisk('greenhouse')" data-risk="greenhouse">
                                <div style="font-size: 3rem; text-align: center; margin-bottom: 8px;">ðŸŒ</div>
                                <h4 style="text-align: center; font-size: 1rem; margin-bottom: 8px;">Greenhouse Gas Leaks</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Click to explore</p>
                            </div>

                            <div class="risk-card" onclick="event.stopPropagation(); selectRisk('safety')" data-risk="safety">
                                <div style="font-size: 3rem; text-align: center; margin-bottom: 8px;">âš ï¸</div>
                                <h4 style="text-align: center; font-size: 1rem; margin-bottom: 8px;">Public Safety</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); text-align: center;">Click to explore</p>
                            </div>
                        </div>

                        <div class="risk-details reg-details" id="risk-groundwater">
                            <h4 style="color: var(--danger); margin-bottom: 12px;">ðŸ’§ Groundwater Contamination</h4>
                            <p><strong>What happens:</strong> Well fluids (brine, oil, gas, chemicals) leak into freshwater aquifers used for drinking water.</p>
                            <p style="margin-top: 8px;"><strong>Impact:</strong> Entire communities can lose access to safe drinking water. Cleanup costs can exceed millions of dollars.</p>
                            <p style="margin-top: 8px;"><strong>Real Example:</strong> In some regions, thousands of abandoned wells contaminate groundwater, requiring expensive water treatment or new water sources.</p>
                            <p style="margin-top: 8px;"><strong>Prevention:</strong> Proper P&A creates permanent barriers preventing fluid migration into aquifers.</p>
                        </div>

                        <div class="risk-details reg-details" id="risk-soil">
                            <h4 style="color: var(--danger); margin-bottom: 12px;">ðŸŒ± Soil Pollution</h4>
                            <p><strong>What happens:</strong> Hydrocarbons and chemicals seep to surface, contaminating agricultural land and ecosystems.</p>
                            <p style="margin-top: 8px;"><strong>Impact:</strong> Land becomes unusable for farming or development. Vegetation dies, wildlife affected, property values plummet.</p>
                            <p style="margin-top: 8px;"><strong>Cleanup Cost:</strong> Soil remediation can cost $100K-$1M+ per site and take years to complete.</p>
                            <p style="margin-top: 8px;"><strong>Prevention:</strong> Proper wellhead abandonment and surface restoration prevents leakage pathways.</p>
                        </div>

                        <div class="risk-details reg-details" id="risk-greenhouse">
                            <h4 style="color: var(--danger); margin-bottom: 12px;">ðŸŒ Greenhouse Gas Emissions</h4>
                            <p><strong>What happens:</strong> Methane (CHâ‚„) and COâ‚‚ escape from poorly sealed wells into atmosphere.</p>
                            <p style="margin-top: 8px;"><strong>Impact:</strong> Methane is 25x more potent than COâ‚‚ as greenhouse gas. One leaking well = emissions of thousands of cars.</p>
                            <p style="margin-top: 8px;"><strong>Global Scale:</strong> Millions of abandoned wells worldwide contribute significantly to climate change.</p>
                            <p style="margin-top: 8px;"><strong>Prevention:</strong> Permanent cement seals block gas migration pathways upward.</p>
                        </div>

                        <div class="risk-details reg-details" id="risk-safety">
                            <h4 style="color: var(--danger); margin-bottom: 12px;">âš ï¸ Public Safety Hazards</h4>
                            <p><strong>What happens:</strong> Gas accumulation in buildings, explosive risk, asphyxiation hazards, physical well bore collapse.</p>
                            <p style="margin-top: 8px;"><strong>Impact:</strong> Injuries, deaths, property damage. Liability extends to current landowner and operator.</p>
                            <p style="margin-top: 8px;"><strong>Legal Consequence:</strong> Criminal charges possible if negligence leads to injury or death.</p>
                            <p style="margin-top: 8px;"><strong>Prevention:</strong> Complete P&A eliminates pathways for dangerous gases and secures wellhead.</p>
                        </div>

                        <p style="margin-top: 16px; padding: 12px; background: rgba(239, 68, 68, 0.1); border-radius: 6px; border-left: 4px solid var(--danger);">
                            <strong>âš ï¸ Bottom Line:</strong> The cost of proper P&A ($100K-$10M) is far less than cleanup costs, legal liability, and environmental damage from improper abandonment. This is why regulations exist and why "just walking away" is never an option.
                        </p>

                        <!-- Before/After P&A Slider -->
                        <div class="interactive-section" style="margin-top: 24px;">
                            <div class="interactive-title">Interactive: Before & After P&A Comparison</div>
                            <p style="margin-bottom: 16px; color: var(--text-secondary);">Drag the slider to compare an improperly abandoned well vs. a properly sealed well</p>

                            <div class="before-after-container">
                                <div class="before-after-slider" id="beforeAfterSlider">
                                    <!-- BEFORE: Leaking Well -->
                                    <div class="before-image">
                                        <div class="before-content">
                                            <div class="well-label">âŒ IMPROPERLY ABANDONED</div>
                                            <div class="well-visual" style="border-color: var(--danger);">
                                                <div class="leak-indicator" style="top: 20%; left: -10px;"></div>
                                                <div class="leak-indicator" style="top: 40%; right: -10px;"></div>
                                                <div class="leak-indicator" style="top: 60%; left: -10px;"></div>
                                                <div class="leak-indicator" style="bottom: 10%; right: -10px;"></div>
                                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3rem;">ðŸ’€</div>
                                            </div>
                                            <div class="well-description">
                                                â€¢ Leaking fluids<br>
                                                â€¢ Groundwater contamination<br>
                                                â€¢ Gas emissions<br>
                                                â€¢ Safety hazard
                                            </div>
                                        </div>
                                    </div>

                                    <!-- AFTER: Properly Sealed Well -->
                                    <div class="after-image" id="afterImage">
                                        <div class="after-content">
                                            <div class="well-label">âœ… PROPERLY SEALED P&A</div>
                                            <div class="well-visual" style="border-color: var(--success);">
                                                <div class="seal-indicator" style="height: 30%; bottom: 0;">
                                                    <div style="text-align: center; padding-top: 5px; font-size: 0.7rem;">Cement Plug</div>
                                                </div>
                                                <div class="seal-indicator" style="height: 25%; top: 35%;">
                                                    <div style="text-align: center; padding-top: 5px; font-size: 0.7rem;">Barrier</div>
                                                </div>
                                                <div style="position: absolute; top: 5%; left: 50%; transform: translateX(-50%); font-size: 0.8rem;">Surface Seal</div>
                                            </div>
                                            <div class="well-description">
                                                â€¢ Multiple barriers<br>
                                                â€¢ No leakage<br>
                                                â€¢ Permanent protection<br>
                                                â€¢ Environmentally safe
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Slider Handle -->
                                    <div class="slider-handle" id="sliderHandle"></div>
                                </div>
                            </div>

                            <p style="margin-top: 16px; text-align: center; font-style: italic; color: var(--muted);">
                                Move the slider to see the dramatic difference proper P&A makes
                            </p>
                        </div>

                        <!-- Well Depth Visualizer -->
                        <div class="interactive-section" style="margin-top: 24px;">
                            <div class="interactive-title">Interactive: Understanding Well Depth & Formation Zones</div>
                            <p style="margin-bottom: 16px; color: var(--text-secondary);">Click on each depth marker to learn what exists at different levels underground and why P&A must seal multiple zones</p>

                            <div class="depth-visualizer">
                                <div class="depth-scale">
                                    <!-- Surface -->
                                    <div class="depth-marker" style="top: 0;" onclick="event.stopPropagation(); selectDepth('surface')" data-depth="surface">
                                        <strong>ðŸžï¸ Surface (0 ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>

                                    <!-- Shallow Aquifer -->
                                    <div class="depth-marker" style="top: 10%;" onclick="event.stopPropagation(); selectDepth('shallow')" data-depth="shallow">
                                        <strong>ðŸ’§ Shallow Aquifer (500 ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>

                                    <!-- Intermediate Zone -->
                                    <div class="depth-marker" style="top: 30%;" onclick="event.stopPropagation(); selectDepth('intermediate')" data-depth="intermediate">
                                        <strong>ðŸª¨ Intermediate Zone (2,000 ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>

                                    <!-- Production Zone -->
                                    <div class="depth-marker" style="top: 55%;" onclick="event.stopPropagation(); selectDepth('production')" data-depth="production">
                                        <strong>â›½ Production Zone (5,000 ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>

                                    <!-- Deep Formation -->
                                    <div class="depth-marker" style="top: 75%;" onclick="event.stopPropagation(); selectDepth('deep')" data-depth="deep">
                                        <strong>ðŸŒ‹ Deep Formation (10,000 ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>

                                    <!-- Ultra Deep -->
                                    <div class="depth-marker" style="top: 95%;" onclick="event.stopPropagation(); selectDepth('ultra-deep')" data-depth="ultra-deep">
                                        <strong>ðŸ”¥ Ultra Deep (15,000+ ft)</strong>
                                        <div style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Click to explore</div>
                                    </div>
                                </div>

                                <!-- Depth Information Panels -->
                                <div class="depth-info reg-details" id="depth-surface" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">ðŸžï¸ Surface Level (0 ft)</h4>
                                    <p><strong>What's here:</strong> Wellhead, surface casing, topsoil, and immediate access point.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Requirements:</strong> Surface plug must be set, wellhead removed, and site restored to original condition.</p>
                                    <p style="margin-top: 8px;"><strong>Critical Point:</strong> This is the first line of defense. A proper surface seal prevents rainwater infiltration and unauthorized access.</p>
                                    <p style="margin-top: 8px;"><strong>Typical Materials:</strong> Cement plug extending 50-100 ft below surface, steel plate cap.</p>
                                </div>

                                <div class="depth-info reg-details" id="depth-shallow" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">ðŸ’§ Shallow Aquifer Zone (500 ft)</h4>
                                    <p><strong>What's here:</strong> Freshwater aquifers used for drinking water, irrigation, and livestock.</p>
                                    <p style="margin-top: 8px;"><strong>Why Critical:</strong> This is the #1 priority in P&A - protecting drinking water sources. Contamination here affects entire communities.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Requirements:</strong> Cement barrier MUST isolate aquifer from well bore. Typically requires 100+ ft cement plug across aquifer zone.</p>
                                    <p style="margin-top: 8px;"><strong>Consequence of Failure:</strong> Aquifer contamination can cost millions to remediate and may be irreversible.</p>
                                </div>

                                <div class="depth-info reg-details" id="depth-intermediate" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">ðŸª¨ Intermediate Zone (2,000 ft)</h4>
                                    <p><strong>What's here:</strong> Transition zone between fresh and saline water, minor gas shows, geological transitions.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Challenge:</strong> May have multiple casing strings, varying pressure zones, and temperature changes.</p>
                                    <p style="margin-top: 8px;"><strong>Barrier Placement:</strong> Strategic cement plugs isolate different pressure regimes and prevent vertical migration.</p>
                                    <p style="margin-top: 8px;"><strong>Testing Required:</strong> Pressure testing confirms barriers hold against formation pressures.</p>
                                </div>

                                <div class="depth-info reg-details" id="depth-production" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">â›½ Production Zone (5,000 ft)</h4>
                                    <p><strong>What's here:</strong> The producing formation where oil/gas was extracted. High pressure, hydrocarbons, formation brine.</p>
                                    <p style="margin-top: 8px;"><strong>Why Sealing Matters:</strong> Residual pressure and hydrocarbons can migrate upward if not properly sealed.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Method:</strong> Mechanical bridge plug or cement retainer set in casing, followed by cement plug across perforations and production interval.</p>
                                    <p style="margin-top: 8px;"><strong>Typical Plug Length:</strong> 100-500 ft of cement to ensure complete isolation.</p>
                                </div>

                                <div class="depth-info reg-details" id="depth-deep" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">ðŸŒ‹ Deep Formation (10,000 ft)</h4>
                                    <p><strong>What's here:</strong> High pressure/high temperature zones, potential secondary hydrocarbon reservoirs.</p>
                                    <p style="margin-top: 8px;"><strong>Conditions:</strong> Temperatures 200-300Â°F, pressures 5,000+ psi, specialized cement required.</p>
                                    <p style="margin-top: 8px;"><strong>Equipment Challenges:</strong> Extreme conditions require specialized tools, high-temp cement, and careful planning.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Approach:</strong> Bottom plug typically set here to provide ultimate barrier against deep reservoir pressures.</p>
                                </div>

                                <div class="depth-info reg-details" id="depth-ultra-deep" style="margin-top: 24px;">
                                    <h4 style="color: var(--accent); margin-bottom: 12px;">ðŸ”¥ Ultra Deep Zone (15,000+ ft)</h4>
                                    <p><strong>What's here:</strong> Deepest producing intervals, extreme conditions, possible salt formations.</p>
                                    <p style="margin-top: 8px;"><strong>Extreme Conditions:</strong> Temperatures 300Â°F+, pressures 10,000+ psi, corrosive environments.</p>
                                    <p style="margin-top: 8px;"><strong>P&A Strategy:</strong> If production occurred this deep, a permanent bottom plug is essential. May use balanced cement or specialized squeeze techniques.</p>
                                    <p style="margin-top: 8px;"><strong>Cost Impact:</strong> Deep P&A operations are expensive but absolutely necessary - costs range $2M-$10M for ultra-deep wells.</p>
                                    <p style="margin-top: 8px;"><strong>Fun Fact:</strong> Some wells exceed 30,000 ft - nearly 6 miles deep! That's deeper than Mount Everest is tall.</p>
                                </div>
                            </div>

                            <p style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                                <strong>ðŸ’¡ Key Takeaway:</strong> P&A isn't just one plug at the surface - it's a carefully engineered system of multiple barriers at strategic depths, each designed to protect specific zones and prevent vertical fluid migration through thousands of feet of geology.
                            </p>
                        </div>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>What are the primary risks of improperly abandoned wells?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q1" value="a"> Economic losses only
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q1" value="b"> Groundwater contamination, soil pollution, and greenhouse gas leaks
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q1" value="c"> Equipment depreciation
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q1" value="d"> Lost production revenue
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(1)">Mark Complete & Continue</button>
                    </div>
                </div>
            </div>

            <!-- Module 2 -->
            <div class="module-card locked" data-module="2" onclick="toggleModule(2)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 2</div>
                        <div class="module-title">Regulatory Frameworks: Prescriptive vs Goal-Setting</div>
                        <div class="module-duration">ðŸ“¹ Video: 01:51 - 02:46</div>
                    </div>
                    <div class="module-status" id="status-2">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Comparing the two fundamental approaches governments use to regulate P&A operations globally.
                </div>
                <div class="module-content" id="content-2">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li><strong>Prescriptive Regulations (USA):</strong> Detailed step-by-step requirements (e.g., specific cement plug lengths)</li>
                            <li>Advantages: Consistency and clear compliance path</li>
                            <li>Disadvantages: Can stifle innovation and adaptation</li>
                            <li><strong>Goal-Setting Regulations (UK/Norway):</strong> Define objective without dictating method</li>
                            <li>Requirement: Rigorous documentation proving effectiveness</li>
                            <li>Advantage: Encourages innovation and best practices</li>
                        </ul>
                    </div>

                    <!-- Interactive Regulatory Comparison -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Compare Regulatory Frameworks</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Click on each regulatory approach to explore their characteristics, advantages, and real-world applications.</p>

                        <div class="reg-comparison">
                            <div class="reg-card" data-reg="prescriptive" onclick="event.stopPropagation(); selectRegulation('prescriptive')">
                                <h5>ðŸ“‹ Prescriptive</h5>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Detailed step-by-step requirements</p>
                                <p style="font-size: 0.85rem; margin-top: 8px;"><strong>Primary Use:</strong> United States</p>
                            </div>

                            <div class="reg-card" data-reg="goal-setting" onclick="event.stopPropagation(); selectRegulation('goal-setting')">
                                <h5>ðŸŽ¯ Goal-Setting</h5>
                                <p style="font-size: 0.9rem; color: var(--text-secondary);">Define objectives, flexible methods</p>
                                <p style="font-size: 0.85rem; margin-top: 8px;"><strong>Primary Use:</strong> UK, Norway</p>
                            </div>
                        </div>

                        <div class="reg-details" id="reg-details-prescriptive">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">Prescriptive Regulations</h4>
                            <p><strong>How it works:</strong> Detailed, step-by-step instructions (e.g., "cement plug must be 100 feet long")</p>
                            <p style="margin-top: 8px;"><strong>Advantages:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 4px;">
                                <li>Clear compliance pathway</li>
                                <li>Consistency across operators</li>
                                <li>Easy to audit and enforce</li>
                                <li>Reduces ambiguity</li>
                            </ul>
                            <p style="margin-top: 8px;"><strong>Disadvantages:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 4px;">
                                <li>Can stifle innovation</li>
                                <li>May not adapt to unique situations</li>
                                <li>Slower to update with new technologies</li>
                            </ul>
                            <p style="margin-top: 8px;"><strong>Real-world example:</strong> US state regulations often specify exact cement plug lengths, casing removal depths, and testing procedures that must be followed precisely.</p>
                        </div>

                        <div class="reg-details" id="reg-details-goal-setting">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">Goal-Setting Regulations</h4>
                            <p><strong>How it works:</strong> Define the end goal (e.g., "well must never leak") without dictating exact methods</p>
                            <p style="margin-top: 8px;"><strong>Advantages:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 4px;">
                                <li>Encourages innovation and best practices</li>
                                <li>Adapts to unique well conditions</li>
                                <li>Promotes continuous improvement</li>
                                <li>Allows use of latest technologies</li>
                            </ul>
                            <p style="margin-top: 8px;"><strong>Disadvantages:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 4px;">
                                <li>Requires extensive documentation</li>
                                <li>Higher burden of proof on operators</li>
                                <li>More complex regulatory oversight</li>
                                <li>Potential for inconsistency</li>
                            </ul>
                            <p style="margin-top: 8px;"><strong>Real-world example:</strong> Norway's "rock-to-rock" barrier requirement allows operators to choose their method, but they must scientifically prove it will prevent leaks in perpetuity.</p>
                        </div>
                    </div>

                    <!-- P&A Decision Tree -->
                    <div class="interactive-section" style="margin-top: 24px;">
                        <div class="interactive-title">Interactive: P&A Decision Tree Navigator</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Answer a series of questions about your well to determine the P&A approach and regulatory requirements that apply</p>

                        <div class="decision-tree">
                            <div class="decision-tree-container">
                                <!-- Question Slides -->
                                <div class="decision-slide active" id="slide-1">
                                    <div class="decision-question">
                                        <h4>Where is the well located?</h4>
                                        <p style="color: var(--muted); margin-top: 8px;">Geographic location determines applicable regulations</p>
                                    </div>
                                    <div class="decision-options">
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(2, 'usa', 'United States')">
                                            ðŸ‡ºðŸ‡¸ United States
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(2, 'uk', 'United Kingdom')">
                                            ðŸ‡¬ðŸ‡§ United Kingdom
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(2, 'norway', 'Norway')">
                                            ðŸ‡³ðŸ‡´ Norway
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(2, 'other', 'Other')">
                                            ðŸŒ Other Country
                                        </button>
                                    </div>
                                </div>

                                <div class="decision-slide" id="slide-2">
                                    <div class="decision-question">
                                        <h4>What type of well is it?</h4>
                                        <p style="color: var(--muted); margin-top: 8px;">Well type affects complexity and requirements</p>
                                    </div>
                                    <div class="decision-options">
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(3, 'oil', 'Oil Production Well')">
                                            â›½ Oil Production Well
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(3, 'gas', 'Gas Production Well')">
                                            ðŸ”¥ Gas Production Well
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(3, 'injection', 'Injection/Disposal Well')">
                                            ðŸ’‰ Injection/Disposal Well
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(3, 'exploration', 'Exploration Well')">
                                            ðŸ” Exploration Well
                                        </button>
                                    </div>
                                </div>

                                <div class="decision-slide" id="slide-3">
                                    <div class="decision-question">
                                        <h4>What is the well depth?</h4>
                                        <p style="color: var(--muted); margin-top: 8px;">Depth impacts complexity and cost</p>
                                    </div>
                                    <div class="decision-options">
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(4, 'shallow', 'Shallow (< 5,000 ft)')">
                                            ðŸ“ Shallow (< 5,000 ft)
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(4, 'medium', 'Medium (5,000 - 10,000 ft)')">
                                            ðŸ“ Medium (5,000 - 10,000 ft)
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(4, 'deep', 'Deep (10,000 - 15,000 ft)')">
                                            ðŸ“Š Deep (10,000 - 15,000 ft)
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); nextDecision(4, 'ultra-deep', 'Ultra-Deep (> 15,000 ft)')">
                                            ðŸ”¬ Ultra-Deep (> 15,000 ft)
                                        </button>
                                    </div>
                                </div>

                                <div class="decision-slide" id="slide-4">
                                    <div class="decision-question">
                                        <h4>Are freshwater aquifers present?</h4>
                                        <p style="color: var(--muted); margin-top: 8px;">Critical factor for environmental protection</p>
                                    </div>
                                    <div class="decision-options">
                                        <button class="decision-btn" onclick="event.stopPropagation(); showResult('aquifer-yes')">
                                            âœ… Yes - Freshwater aquifers present
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); showResult('aquifer-no')">
                                            âŒ No - No freshwater zones
                                        </button>
                                        <button class="decision-btn" onclick="event.stopPropagation(); showResult('aquifer-unknown')">
                                            â“ Unknown - Needs assessment
                                        </button>
                                    </div>
                                </div>

                                <!-- Result Section -->
                                <div class="decision-result" id="decision-result">
                                    <h4 style="color: var(--accent); margin-bottom: 16px;">Your P&A Requirements</h4>

                                    <div class="result-summary" id="result-summary">
                                        <!-- Populated by JavaScript -->
                                    </div>

                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); resetDecisionTree()" style="margin-top: 20px; width: 100%;">
                                        Start Over
                                    </button>
                                </div>
                            </div>

                            <!-- Breadcrumb Trail -->
                            <div class="decision-breadcrumb" id="decision-breadcrumb">
                                <span style="color: var(--muted);">Your selections: </span>
                                <span id="breadcrumb-trail" style="color: var(--accent);"></span>
                            </div>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                            <p><strong>ðŸ’¡ Note:</strong> This decision tree provides general guidance. Always consult local regulations, qualified engineers, and regulatory authorities for your specific P&A requirements. Regulations vary by jurisdiction and can change over time.</p>
                        </div>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>Which regulatory approach requires operators to prove their methods work through rigorous documentation?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q2" value="a"> Prescriptive regulations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q2" value="b"> Goal-setting regulations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q2" value="c"> Both equally
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q2" value="d"> Neither approach requires documentation
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(2)">Mark Complete & Continue</button>
                    </div>
                </div>
            </div>

            <!-- Module 3 -->
            <div class="module-card locked" data-module="3" onclick="toggleModule(3)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 3</div>
                        <div class="module-title">Global Standards & Country-Specific Approaches</div>
                        <div class="module-duration">ðŸ“¹ Video: 02:47 - 06:49</div>
                    </div>
                    <div class="module-status" id="status-3">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Exploring ISO 16530-1 standards and how different countries (Norway, UK, USA, Australia) implement P&A regulations.
                </div>
                <div class="module-content" id="content-3">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li><strong>ISO 16530-1:</strong> Universal global standard defining core P&A principles</li>
                            <li>Defines permanent barriers as foundational requirement</li>
                            <li><strong>Norway:</strong> Gold standard "rock-to-rock" barrier; scientific proof required</li>
                            <li><strong>United Kingdom:</strong> Goal-setting with liability in perpetuity</li>
                            <li><strong>United States:</strong> Primarily prescriptive state rules; federal shift to performance-based (Gulf of Mexico)</li>
                            <li><strong>Australia:</strong> Transitioning from prescriptive to goal-setting; strong evidence required for leaving equipment</li>
                        </ul>
                    </div>

                    <!-- Interactive Global Standards Explorer -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Explore Global P&A Standards</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Click on each country to explore how they implement P&A regulations under the ISO 16530-1 framework.</p>

                        <div class="standards-grid">
                            <div class="country-card" data-country="norway" onclick="event.stopPropagation(); exploreCountry('norway')">
                                <div class="country-flag">ðŸ‡³ðŸ‡´</div>
                                <div class="country-name">Norway</div>
                                <div class="country-type">Goal-Setting</div>
                            </div>

                            <div class="country-card" data-country="uk" onclick="event.stopPropagation(); exploreCountry('uk')">
                                <div class="country-flag">ðŸ‡¬ðŸ‡§</div>
                                <div class="country-name">United Kingdom</div>
                                <div class="country-type">Goal-Setting</div>
                            </div>

                            <div class="country-card" data-country="usa" onclick="event.stopPropagation(); exploreCountry('usa')">
                                <div class="country-flag">ðŸ‡ºðŸ‡¸</div>
                                <div class="country-name">United States</div>
                                <div class="country-type">Prescriptive</div>
                            </div>

                            <div class="country-card" data-country="australia" onclick="event.stopPropagation(); exploreCountry('australia')">
                                <div class="country-flag">ðŸ‡¦ðŸ‡º</div>
                                <div class="country-name">Australia</div>
                                <div class="country-type">Transitioning</div>
                            </div>
                        </div>

                        <div class="country-details reg-details" id="country-details-norway">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ‡³ðŸ‡´ Norway - The Gold Standard</h4>
                            <p><strong>Regulatory Approach:</strong> Goal-setting with rigorous scientific validation</p>
                            <p style="margin-top: 8px;"><strong>Key Requirement:</strong> "Rock-to-rock" barrier - operators must scientifically prove their P&A design will prevent leaks in perpetuity.</p>
                            <p style="margin-top: 8px;"><strong>Innovation:</strong> Encourages cutting-edge technology and methods, but demands comprehensive documentation and proof.</p>
                            <p style="margin-top: 8px;"><strong>Why it's considered the gold standard:</strong> Combines flexibility with the highest safety standards, requiring operators to think beyond simple compliance.</p>
                        </div>

                        <div class="country-details reg-details" id="country-details-uk">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ‡¬ðŸ‡§ United Kingdom - Perpetual Accountability</h4>
                            <p><strong>Regulatory Approach:</strong> Goal-setting with liability in perpetuity</p>
                            <p style="margin-top: 8px;"><strong>Key Requirement:</strong> Well must never leak - operators choose methods but bear responsibility forever.</p>
                            <p style="margin-top: 8px;"><strong>Trailing Liability:</strong> If current owner goes bankrupt, regulators can pursue previous owners for decommissioning costs.</p>
                            <p style="margin-top: 8px;"><strong>Impact:</strong> Creates culture of meticulous planning and long-term thinking, as liability truly never ends.</p>
                        </div>

                        <div class="country-details reg-details" id="country-details-usa">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ‡ºðŸ‡¸ United States - State-by-State Prescriptive</h4>
                            <p><strong>Regulatory Approach:</strong> Primarily prescriptive state regulations</p>
                            <p style="margin-top: 8px;"><strong>Key Requirement:</strong> Detailed step-by-step instructions (e.g., "cement plug must be X feet long at Y depth").</p>
                            <p style="margin-top: 8px;"><strong>Evolution:</strong> Federal regulators in complex areas like Gulf of Mexico shifting toward performance-based models.</p>
                            <p style="margin-top: 8px;"><strong>Advantage:</strong> Clear compliance pathway, easy to audit and enforce across thousands of operators.</p>
                        </div>

                        <div class="country-details reg-details" id="country-details-australia">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ‡¦ðŸ‡º Australia - In Transition</h4>
                            <p><strong>Regulatory Approach:</strong> Actively transitioning from prescriptive to goal-setting</p>
                            <p style="margin-top: 8px;"><strong>Key Requirement:</strong> Strong evidence required if equipment is left in place rather than removed.</p>
                            <p style="margin-top: 8px;"><strong>Current Focus:</strong> Building regulatory capacity and operator expertise for goal-setting framework.</p>
                            <p style="margin-top: 8px;"><strong>Future:</strong> Moving toward Norwegian-style scientific validation with Australian environmental considerations.</p>
                        </div>

                        <p style="margin-top: 16px; font-size: 0.9rem; padding: 12px; background: var(--bg-light); border-radius: 6px;">
                            <strong>ðŸŒ ISO 16530-1 Role:</strong> Provides universal grammar defining permanent barriers and core principles, allowing each country to implement based on their specific needs while maintaining global safety standards.
                        </p>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>What is ISO 16530-1's role in global P&A operations?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q3" value="a"> It replaces all national regulations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q3" value="b"> It defines core principles and acts as a bridge between regulatory systems
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q3" value="c"> It only applies to offshore operations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q3" value="d"> It is voluntary guidance with no legal weight
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(3)">Mark Complete & Continue</button>
                    </div>
                </div>
            </div>

            <!-- Module 4 -->
            <div class="module-card locked" data-module="4" onclick="toggleModule(4)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 4</div>
                        <div class="module-title">Technical Barrier Systems</div>
                        <div class="module-duration">ðŸ“¹ Video: 06:50 - 07:42</div>
                    </div>
                    <div class="module-status" id="status-4">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Understanding barrier design, components, and verification requirements for permanent well sealing.
                </div>
                <div class="module-content" id="content-4">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li>Barrier system blocks fluid movement permanently</li>
                            <li>Components: Cement plug + steel casing + surrounding rock formation</li>
                            <li>Objective: Restore natural seal that existed before drilling</li>
                            <li>Verification methods: Pressure testing and logging</li>
                            <li>Mandatory integrity confirmation before completion</li>
                            <li>Multiple barriers for redundancy and safety</li>
                        </ul>
                    </div>

                    <!-- Interactive Barrier Builder -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Build a P&A Barrier</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Drag and drop the three essential components to build a proper P&A barrier in the correct sequence.</p>

                        <div class="barrier-builder">
                            <div class="barrier-components">
                                <h4 style="margin-bottom: 12px; font-size: 1rem;">Available Components</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 12px;">Drag these to the right â†’</p>

                                <div class="component-item" draggable="true" data-type="cement" data-name="Cement Plug"
                                     ondragstart="drag(event)" ondragend="dragEnd(event)">
                                    <strong>ðŸ—ï¸ Cement Plug</strong>
                                    <p style="font-size: 0.85rem; margin-top: 4px; color: var(--text-secondary);">Primary sealing material</p>
                                </div>

                                <div class="component-item" draggable="true" data-type="casing" data-name="Steel Casing"
                                     ondragstart="drag(event)" ondragend="dragEnd(event)">
                                    <strong>âš™ï¸ Steel Casing</strong>
                                    <p style="font-size: 0.85rem; margin-top: 4px; color: var(--text-secondary);">Structural integrity</p>
                                </div>

                                <div class="component-item" draggable="true" data-type="formation" data-name="Rock Formation"
                                     ondragstart="drag(event)" ondragend="dragEnd(event)">
                                    <strong>ðŸª¨ Rock Formation</strong>
                                    <p style="font-size: 0.85rem; margin-top: 4px; color: var(--text-secondary);">Natural geological seal</p>
                                </div>

                                <button class="btn btn-secondary" onclick="event.stopPropagation(); resetBarrier()" style="margin-top: 16px; width: 100%;">
                                    Reset Barrier
                                </button>
                            </div>

                            <div class="barrier-preview">
                                <h4 style="margin-bottom: 12px; font-size: 1rem;">Barrier Design</h4>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">Drop components here in correct order â†“</p>

                                <div class="barrier-layer" data-type="formation"
                                     ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDragOver(event)">
                                    Drop formation here
                                </div>

                                <div class="barrier-layer" data-type="casing"
                                     ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDragOver(event)">
                                    Drop casing here
                                </div>

                                <div class="barrier-layer" data-type="cement"
                                     ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="clearDragOver(event)">
                                    Drop cement here
                                </div>

                                <div id="barrier-result" style="display: none; margin-top: 16px; padding: 16px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border-left: 4px solid var(--success);"></div>
                            </div>
                        </div>

                        <p style="margin-top: 16px; font-size: 0.9rem; color: var(--text-secondary);">
                            <strong>ðŸ’¡ Tip:</strong> A proper barrier requires all three components working together - the rock formation provides natural containment, steel casing provides structural integrity, and cement creates the permanent seal.
                        </p>
                    </div>

                    <!-- Cement Volume Calculator -->
                    <div class="interactive-section" style="margin-top: 24px;">
                        <div class="interactive-title">Interactive: Cement Volume Calculator</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Calculate how much cement is needed to create a plug based on wellbore dimensions. Understanding volumes is critical for proper P&A planning.</p>

                        <div class="cement-calculator">
                            <div class="calculator-inputs">
                                <div class="input-group">
                                    <label for="hole-diameter">
                                        <strong>Hole Diameter (inches)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Inner diameter of the wellbore</span>
                                    </label>
                                    <input type="number" id="hole-diameter" class="calc-input" value="8.5" min="4" max="36" step="0.5" oninput="calculateCement()">
                                </div>

                                <div class="input-group">
                                    <label for="plug-length">
                                        <strong>Plug Length (feet)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Height of cement plug required</span>
                                    </label>
                                    <input type="number" id="plug-length" class="calc-input" value="100" min="10" max="1000" step="10" oninput="calculateCement()">
                                </div>

                                <div class="input-group">
                                    <label for="casing-od">
                                        <strong>Casing Outer Diameter (inches)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Leave at 0 if cementing open hole</span>
                                    </label>
                                    <input type="number" id="casing-od" class="calc-input" value="0" min="0" max="20" step="0.5" oninput="calculateCement()">
                                </div>

                                <div class="input-group">
                                    <label for="safety-factor">
                                        <strong>Safety Factor (%)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Extra cement for washouts/irregularities</span>
                                    </label>
                                    <input type="number" id="safety-factor" class="calc-input" value="20" min="0" max="50" step="5" oninput="calculateCement()">
                                </div>

                                <button class="btn btn-primary" onclick="event.stopPropagation(); calculateCement()" style="width: 100%; margin-top: 12px;">
                                    Calculate Volume
                                </button>
                            </div>

                            <div class="calculator-results" id="cement-results">
                                <h4 style="margin-bottom: 16px; color: var(--accent);">Calculation Results</h4>

                                <div class="result-item">
                                    <span class="result-label">Hole Volume:</span>
                                    <span class="result-value" id="hole-volume">0</span>
                                    <span class="result-unit">cubic feet</span>
                                </div>

                                <div class="result-item">
                                    <span class="result-label">Annular Volume:</span>
                                    <span class="result-value" id="annular-volume">0</span>
                                    <span class="result-unit">cubic feet</span>
                                </div>

                                <div class="result-item">
                                    <span class="result-label">Base Cement Required:</span>
                                    <span class="result-value" id="base-cement">0</span>
                                    <span class="result-unit">sacks (94 lb)</span>
                                </div>

                                <div class="result-item" style="border-top: 2px solid var(--accent); padding-top: 12px; margin-top: 12px;">
                                    <span class="result-label"><strong>Total with Safety Factor:</strong></span>
                                    <span class="result-value" id="total-cement" style="font-size: 1.4rem; color: var(--accent);"><strong>0</strong></span>
                                    <span class="result-unit"><strong>sacks</strong></span>
                                </div>

                                <div class="result-item">
                                    <span class="result-label">Estimated Cost:</span>
                                    <span class="result-value" id="cement-cost">$0</span>
                                    <span class="result-unit">@ $15/sack</span>
                                </div>

                                <div class="result-item">
                                    <span class="result-label">Approximate Weight:</span>
                                    <span class="result-value" id="cement-weight">0</span>
                                    <span class="result-unit">lbs</span>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                            <p style="margin-bottom: 8px;"><strong>ðŸ“Š Understanding the Calculations:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px; line-height: 1.6;">
                                <li><strong>Hole Volume:</strong> Ï€ Ã— (diameter/2)Â² Ã— length - the volume of the cylindrical space</li>
                                <li><strong>Annular Volume:</strong> Volume between casing and hole wall (if casing present)</li>
                                <li><strong>Cement Yield:</strong> One 94-lb sack of Class H cement yields approximately 1.15 cubic feet</li>
                                <li><strong>Safety Factor:</strong> Industry standard 10-30% extra to account for washouts, hole irregularities, and losses</li>
                                <li><strong>Real-World Application:</strong> Operators must order cement in advance - underestimating means job failure, overestimating wastes money</li>
                            </ul>
                        </div>

                        <div style="margin-top: 12px; padding: 12px; background: rgba(234, 179, 8, 0.1); border-radius: 6px; border-left: 4px solid var(--warning);">
                            <p><strong>âš ï¸ Pro Tip:</strong> For critical P&A plugs, always err on the side of excess cement. Running out mid-job means pulling equipment, waiting for more cement, and potentially compromising the plug integrity. A 20-30% safety factor is industry standard.</p>
                        </div>
                    </div>

                    <!-- Barrier Sequence Builder -->
                    <div class="interactive-section" style="margin-top: 24px;">
                        <div class="interactive-title">Interactive: Multi-Barrier Sequence Builder</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Build a proper P&A sequence by placing barriers at strategic depths. A complete P&A requires multiple barriers from bottom to top.</p>

                        <div class="sequence-builder">
                            <div class="builder-controls">
                                <h4 style="margin-bottom: 16px;">Available Barrier Types</h4>

                                <div class="barrier-type-selector">
                                    <div class="barrier-type-card" data-barrier="bridge-plug">
                                        <div style="font-size: 2rem; text-align: center; margin-bottom: 8px;">ðŸ”©</div>
                                        <strong>Bridge Plug</strong>
                                        <p style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Mechanical barrier at bottom</p>
                                        <button class="btn btn-small btn-accent" onclick="event.stopPropagation(); addBarrier('bridge-plug', 'Bridge Plug', 'ðŸ”©')" style="width: 100%; margin-top: 8px;">
                                            Add to Sequence
                                        </button>
                                    </div>

                                    <div class="barrier-type-card" data-barrier="cement-plug">
                                        <div style="font-size: 2rem; text-align: center; margin-bottom: 8px;">ðŸ—ï¸</div>
                                        <strong>Cement Plug</strong>
                                        <p style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Primary sealing barrier</p>
                                        <button class="btn btn-small btn-accent" onclick="event.stopPropagation(); addBarrier('cement-plug', 'Cement Plug', 'ðŸ—ï¸')" style="width: 100%; margin-top: 8px;">
                                            Add to Sequence
                                        </button>
                                    </div>

                                    <div class="barrier-type-card" data-barrier="aquifer-seal">
                                        <div style="font-size: 2rem; text-align: center; margin-bottom: 8px;">ðŸ’§</div>
                                        <strong>Aquifer Seal</strong>
                                        <p style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Protects drinking water</p>
                                        <button class="btn btn-small btn-accent" onclick="event.stopPropagation(); addBarrier('aquifer-seal', 'Aquifer Seal', 'ðŸ’§')" style="width: 100%; margin-top: 8px;">
                                            Add to Sequence
                                        </button>
                                    </div>

                                    <div class="barrier-type-card" data-barrier="surface-plug">
                                        <div style="font-size: 2rem; text-align: center; margin-bottom: 8px;">ðŸŽ¯</div>
                                        <strong>Surface Plug</strong>
                                        <p style="font-size: 0.85rem; color: var(--muted); margin-top: 4px;">Final cap at top</p>
                                        <button class="btn btn-small btn-accent" onclick="event.stopPropagation(); addBarrier('surface-plug', 'Surface Plug', 'ðŸŽ¯')" style="width: 100%; margin-top: 8px;">
                                            Add to Sequence
                                        </button>
                                    </div>
                                </div>

                                <div style="margin-top: 16px;">
                                    <button class="btn btn-secondary" onclick="event.stopPropagation(); resetSequence()" style="width: 100%;">
                                        Reset Sequence
                                    </button>
                                    <button class="btn btn-primary" onclick="event.stopPropagation(); validateSequence()" style="width: 100%; margin-top: 8px;">
                                        Validate My Sequence
                                    </button>
                                </div>
                            </div>

                            <div class="wellbore-visual">
                                <h4 style="margin-bottom: 16px; text-align: center;">Wellbore Cross-Section</h4>
                                <div class="wellbore-container">
                                    <!-- Surface (0 ft) -->
                                    <div class="depth-zone" data-zone="surface">
                                        <div class="zone-label">Surface (0 ft)</div>
                                        <div class="barrier-slot" id="slot-surface" data-required="surface-plug"></div>
                                    </div>

                                    <!-- Shallow Aquifer (500 ft) -->
                                    <div class="depth-zone" data-zone="aquifer">
                                        <div class="zone-label">Aquifer (500 ft)</div>
                                        <div class="barrier-slot" id="slot-aquifer" data-required="aquifer-seal"></div>
                                    </div>

                                    <!-- Intermediate (2,000 ft) -->
                                    <div class="depth-zone" data-zone="intermediate">
                                        <div class="zone-label">Intermediate (2,000 ft)</div>
                                        <div class="barrier-slot" id="slot-intermediate" data-required="cement-plug"></div>
                                    </div>

                                    <!-- Production Zone (5,000 ft) -->
                                    <div class="depth-zone" data-zone="production">
                                        <div class="zone-label">Production (5,000 ft)</div>
                                        <div class="barrier-slot" id="slot-production" data-required="cement-plug"></div>
                                    </div>

                                    <!-- Bottom (8,000 ft) -->
                                    <div class="depth-zone" data-zone="bottom">
                                        <div class="zone-label">Bottom (8,000 ft)</div>
                                        <div class="barrier-slot" id="slot-bottom" data-required="bridge-plug"></div>
                                    </div>
                                </div>

                                <div id="sequence-feedback" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                            </div>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                            <p style="margin-bottom: 8px;"><strong>ðŸŽ“ Proper P&A Sequence (Bottom to Top):</strong></p>
                            <ol style="margin-left: 20px; line-height: 1.8;">
                                <li><strong>Bridge Plug (Bottom):</strong> Mechanical barrier at TD (total depth) to hold cement above</li>
                                <li><strong>Production Zone Cement:</strong> Seal production perforations and prevent hydrocarbon migration</li>
                                <li><strong>Intermediate Cement:</strong> Isolate intermediate zones and provide redundancy</li>
                                <li><strong>Aquifer Seal:</strong> CRITICAL - 100+ ft cement plug to protect drinking water</li>
                                <li><strong>Surface Plug:</strong> Final 50-100 ft cement plug, wellhead cut below ground, site restored</li>
                            </ol>
                            <p style="margin-top: 8px; font-style: italic; color: var(--muted);">Each barrier must be pressure tested before proceeding to the next. Redundancy is key - if one barrier fails, others prevent leakage.</p>
                        </div>
                    </div>

                    <!-- Pressure Test Simulator -->
                    <div class="interactive-section" style="margin-top: 24px;">
                        <div class="interactive-title">Interactive: Pressure Test Simulator</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Simulate a pressure test on a cement plug to verify barrier integrity. Set test pressure and watch for leaks.</p>

                        <div class="pressure-test-container">
                            <div class="test-controls-panel">
                                <h4 style="margin-bottom: 16px;">Test Parameters</h4>

                                <div class="pressure-gauge-display">
                                    <div class="gauge-circle">
                                        <div class="gauge-value" id="current-pressure">0</div>
                                        <div class="gauge-unit">PSI</div>
                                    </div>
                                    <div class="gauge-label">Current Test Pressure</div>
                                </div>

                                <div class="input-group" style="margin-top: 20px;">
                                    <label for="target-pressure">
                                        <strong>Target Test Pressure (PSI)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Typical: 500-2000 PSI</span>
                                    </label>
                                    <input type="number" id="target-pressure" class="calc-input" value="1000" min="100" max="5000" step="100">
                                </div>

                                <div class="input-group">
                                    <label for="test-duration">
                                        <strong>Test Duration (minutes)</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Standard: 30 minutes minimum</span>
                                    </label>
                                    <input type="number" id="test-duration" class="calc-input" value="30" min="10" max="120" step="5">
                                </div>

                                <div class="input-group">
                                    <label for="plug-quality">
                                        <strong>Plug Quality</strong>
                                        <span style="display: block; font-size: 0.85rem; color: var(--muted); font-weight: normal;">Simulated cement condition</span>
                                    </label>
                                    <select id="plug-quality" class="calc-input">
                                        <option value="excellent">Excellent (Proper mix, full cure)</option>
                                        <option value="good">Good (Minor imperfections)</option>
                                        <option value="fair">Fair (Some voids present)</option>
                                        <option value="poor">Poor (Major defects)</option>
                                    </select>
                                </div>

                                <button class="btn btn-primary" onclick="event.stopPropagation(); startPressureTest()" id="start-test-btn" style="width: 100%; margin-top: 16px;">
                                    Start Pressure Test
                                </button>
                                <button class="btn btn-secondary" onclick="event.stopPropagation(); resetPressureTest()" style="width: 100%; margin-top: 8px;">
                                    Reset Test
                                </button>
                            </div>

                            <div class="test-visualization-panel">
                                <h4 style="margin-bottom: 16px; text-align: center;">Test Visualization</h4>

                                <div class="barrier-test-visual">
                                    <div class="wellbore-section">
                                        <div class="formation-wall left"></div>
                                        <div class="cement-plug" id="cement-plug">
                                            <div class="plug-label">Cement Plug Under Test</div>
                                        </div>
                                        <div class="formation-wall right"></div>
                                    </div>

                                    <div class="pressure-arrows" id="pressure-arrows" style="display: none;">
                                        <div class="arrow up">â¬†ï¸ Pressure Applied</div>
                                        <div class="arrow down">â¬‡ï¸ Pressure Applied</div>
                                    </div>

                                    <div class="leak-indicators" id="leak-indicators"></div>
                                </div>

                                <div class="test-progress" id="test-progress" style="display: none;">
                                    <div class="progress-label">
                                        <span>Test Progress</span>
                                        <span id="progress-time">0%</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="progress-fill"></div>
                                    </div>
                                </div>

                                <div id="test-results" style="margin-top: 16px; padding: 16px; border-radius: 8px; display: none;"></div>
                            </div>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                            <p style="margin-bottom: 8px;"><strong>ðŸ§ª About Pressure Testing:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px; line-height: 1.8;">
                                <li><strong>Purpose:</strong> Verify cement plug can withstand formation pressures without leaking</li>
                                <li><strong>Method:</strong> Apply pressure from surface, monitor for pressure drop over time</li>
                                <li><strong>Pass Criteria:</strong> Pressure must hold steady (Â±10 PSI max) for entire test duration</li>
                                <li><strong>Failure:</strong> Significant pressure drop indicates leak - plug must be remediated</li>
                                <li><strong>Regulation:</strong> Most jurisdictions require documented pressure test before approval</li>
                                <li><strong>Consequences:</strong> Failed test means costly remediation: perforate plug, squeeze more cement, re-test</li>
                            </ul>
                        </div>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>What are the three main components of a proper P&A barrier?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q4" value="a"> Cement, steel, and rock formation
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q4" value="b"> Cement, mud, and gravel
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q4" value="c"> Steel, concrete, and plastic
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q4" value="d"> Only cement is required
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(4)">Mark Complete & Continue</button>
                        <a href="sop-library.html" class="btn btn-secondary">View Related SOPs</a>
                    </div>
                </div>
            </div>

            <!-- Module 5 -->
            <div class="module-card locked" data-module="5" onclick="toggleModule(5)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 5</div>
                        <div class="module-title">Liability in Perpetuity & Long-Term Responsibility</div>
                        <div class="module-duration">ðŸ“¹ Video: 07:43 - 09:48</div>
                    </div>
                    <div class="module-status" id="status-5">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Critical understanding of permanent liability, trailing liability, and why operators remain responsible indefinitely.
                </div>
                <div class="module-content" id="content-5">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li><strong>Liability in Perpetuity:</strong> Responsibility continues indefinitely after plugging</li>
                            <li>Current owner liable for leaks occurring decades after abandonment</li>
                            <li>Cannot simply walk away after job completion</li>
                            <li><strong>Trailing Liability (UK):</strong> Regulators can pursue previous owners if current owner goes bankrupt</li>
                            <li>Prevents offloading risky assets to unstable operators</li>
                            <li>Encourages thorough due diligence in asset transactions</li>
                            <li>Long-term planning essential for corporate risk management</li>
                        </ul>
                    </div>

                    <!-- Interactive Liability Timeline -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Perpetual Liability Timeline</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Click on timeline events to see how liability persists across generations. This visualization demonstrates why "in perpetuity" truly means forever.</p>

                        <div class="timeline-container">
                            <div class="timeline">
                                <div class="timeline-item" data-year="0" onclick="event.stopPropagation(); highlightTimelineItem(0)">
                                    <div class="timeline-year">Year 0: Well Plugged</div>
                                    <div class="timeline-description">
                                        Well is permanently abandoned using approved P&A procedures. Operator believes job is complete.
                                        <strong style="display: block; margin-top: 4px; color: var(--accent);">âš ï¸ Liability begins - and never ends.</strong>
                                    </div>
                                </div>

                                <div class="timeline-item" data-year="10" onclick="event.stopPropagation(); highlightTimelineItem(10)">
                                    <div class="timeline-year">Year 10: First Decade</div>
                                    <div class="timeline-description">
                                        Barriers remain intact. Operator still liable for any leaks or integrity issues.
                                        Original engineers may still be with company, institutional knowledge preserved.
                                    </div>
                                </div>

                                <div class="timeline-item" data-year="25" onclick="event.stopPropagation(); highlightTimelineItem(25)">
                                    <div class="timeline-year">Year 25: Generation Shift</div>
                                    <div class="timeline-description">
                                        Original P&A team has retired. New generation manages liability.
                                        Documentation becomes critical - institutional knowledge fading.
                                        <strong style="display: block; margin-top: 4px; color: var(--warning);">Current owner still liable, regardless of ownership changes.</strong>
                                    </div>
                                </div>

                                <div class="timeline-item" data-year="50" onclick="event.stopPropagation(); highlightTimelineItem(50)">
                                    <div class="timeline-year">Year 50: Half Century</div>
                                    <div class="timeline-description">
                                        Two generations since plugging. Company may have changed hands multiple times.
                                        If leak occurs, current owner bears full responsibility AND cleanup costs.
                                        <strong style="display: block; margin-top: 4px; color: var(--danger);">UK Trailing Liability: Previous owners can also be pursued.</strong>
                                    </div>
                                </div>

                                <div class="timeline-item" data-year="100" onclick="event.stopPropagation(); highlightTimelineItem(100)">
                                    <div class="timeline-year">Year 100+: Perpetuity</div>
                                    <div class="timeline-description">
                                        A century later, the well must still never leak. No statute of limitations exists.
                                        Demonstrates why "permanent" barrier design is critical - there is no end date.
                                        <strong style="display: block; margin-top: 4px; color: var(--success);">This is why proper P&A design and documentation matters.</strong>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1)); border-radius: 8px; border-left: 4px solid var(--danger);">
                            <p style="font-weight: 600; margin-bottom: 8px;">ðŸ’¡ Key Insight: The Forever Responsibility</p>
                            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                                Unlike most business transactions with defined liability periods, P&A liability truly has no expiration date.
                                This drives conservative design choices, meticulous documentation, and long-term financial planning.
                                Companies must consider: "Will this barrier work in 100 years? Can we prove it?"
                            </p>
                        </div>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>What is "trailing liability" in P&A operations?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q5" value="a"> Liability only lasts 10 years
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q5" value="b"> Previous owners can be pursued if current owner goes bankrupt
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q5" value="c"> Liability transfers to the government
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q5" value="d"> Liability ends when the well is plugged
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(5)">Mark Complete & Continue</button>
                    </div>
                </div>
            </div>

            <!-- Module 6 -->
            <div class="module-card locked" data-module="6" onclick="toggleModule(6)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 6</div>
                        <div class="module-title">Financial Assurance & Innovation</div>
                        <div class="module-duration">ðŸ“¹ Video: 09:49 - 11:24</div>
                    </div>
                    <div class="module-status" id="status-6">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Understanding bonding requirements, financial guarantees, and innovative approaches like rigs-to-reefs programs.
                </div>
                <div class="module-content" id="content-6">
                    <div class="key-points">
                        <h4>Key Learning Points:</h4>
                        <ul>
                            <li><strong>Financial Bonds:</strong> Companies must post bonds guaranteeing P&A funding</li>
                            <li>Regulators updating bond amounts to reflect real-world costs</li>
                            <li>Prevents abandonment of wells due to financial insolvency</li>
                            <li>Bond amounts increasing globally to match actual decommissioning costs</li>
                            <li><strong>Rigs-to-Reefs:</strong> Offshore platforms converted to artificial reefs in some regions</li>
                            <li>Requires strict environmental review confirming benefits > risks</li>
                            <li>Not universally accepted; jurisdiction-specific approval needed</li>
                        </ul>
                    </div>

                    <!-- Interactive Financial Calculator -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: P&A Bond Calculator</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Calculate estimated P&A bonding requirements based on well characteristics. Adjust parameters to see how depth, complexity, and location affect financial assurance needs.</p>

                        <div class="calculator">
                            <div class="calc-input-group">
                                <label class="calc-label" for="well-depth">Well Depth (feet)</label>
                                <input type="number" id="well-depth" class="calc-input" value="10000" min="0" max="35000" step="1000" onchange="calculatePABond()">
                                <small style="color: var(--text-secondary);">Deeper wells = higher complexity and cost</small>
                            </div>

                            <div class="calc-input-group">
                                <label class="calc-label" for="complexity">Operation Complexity: <span id="complexity-value">Medium</span></label>
                                <input type="range" id="complexity" class="calc-slider" value="2" min="1" max="3" step="1" oninput="calculatePABond()">
                                <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">
                                    <span>Low</span>
                                    <span>Medium</span>
                                    <span>High</span>
                                </div>
                                <small style="color: var(--text-secondary);">Complexity factors: multiple zones, high pressure, contamination, difficult access</small>
                            </div>

                            <div class="calc-input-group">
                                <label class="calc-label" for="location">Well Location</label>
                                <select id="location" class="calc-input" onchange="calculatePABond()">
                                    <option value="onshore">Onshore (Land)</option>
                                    <option value="shallow-water" selected>Shallow Water (< 500 ft)</option>
                                    <option value="deep-water">Deep Water (500-5000 ft)</option>
                                    <option value="ultra-deep">Ultra-Deep Water (> 5000 ft)</option>
                                </select>
                                <small style="color: var(--text-secondary);">Offshore operations significantly increase costs due to logistics and equipment</small>
                            </div>

                            <div class="calc-result">
                                <div class="calc-result-label">Estimated P&A Bond Requirement</div>
                                <div class="calc-result-value" id="bond-amount">$750,000</div>
                                <small style="display: block; margin-top: 8px; opacity: 0.9;">
                                    This is a simplified educational calculation. Actual bonding requirements vary by jurisdiction and specific well conditions.
                                </small>
                            </div>

                            <div style="margin-top: 16px; padding: 12px; background: var(--bg-light); border-radius: 6px; font-size: 0.9rem;">
                                <p style="margin-bottom: 8px;"><strong>ðŸ“Š Understanding the Factors:</strong></p>
                                <ul style="margin-left: 20px; color: var(--text-secondary);">
                                    <li><strong>Depth:</strong> Base rate of ~$50/foot increases with complexity</li>
                                    <li><strong>Complexity:</strong> 1x (simple) to 3x (high complexity) multiplier</li>
                                    <li><strong>Location:</strong> Offshore adds 1.5x to 4x due to logistics, rig costs, weather delays</li>
                                    <li><strong>Actual Costs:</strong> Can range from $100K (simple onshore) to $10M+ (ultra-deep complex)</li>
                                </ul>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(16, 185, 129, 0.1)); border-radius: 8px; border-left: 4px solid var(--accent);">
                            <p style="font-weight: 600; margin-bottom: 8px;">ðŸ’° Why Bonds Are Increasing</p>
                            <p style="font-size: 0.9rem; color: var(--text-secondary);">
                                Historically, bond amounts were often underestimated. When operators went bankrupt, governments had to cover shortfalls using taxpayer money.
                                Modern regulators now require bonds that reflect true P&A costs, protecting taxpayers and ensuring wells don't become "orphaned."
                            </p>
                        </div>
                    </div>

                    <!-- Cost Breakdown Pie Chart -->
                    <div class="interactive-section" style="margin-top: 24px;">
                        <div class="interactive-title">Interactive: P&A Cost Breakdown Analysis</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Explore how P&A costs break down across different expense categories. Click each segment to see detailed cost information.</p>

                        <div class="cost-breakdown-container">
                            <div class="pie-chart-section">
                                <div class="pie-chart-wrapper">
                                    <div class="pie-chart" id="cost-pie-chart">
                                        <!-- Segments created dynamically -->
                                        <div class="pie-segment equipment" data-category="equipment" onclick="event.stopPropagation(); selectCostCategory('equipment')"></div>
                                        <div class="pie-segment labor" data-category="labor" onclick="event.stopPropagation(); selectCostCategory('labor')"></div>
                                        <div class="pie-segment materials" data-category="materials" onclick="event.stopPropagation(); selectCostCategory('materials')"></div>
                                        <div class="pie-segment testing" data-category="testing" onclick="event.stopPropagation(); selectCostCategory('testing')"></div>
                                        <div class="pie-segment mobilization" data-category="mobilization" onclick="event.stopPropagation(); selectCostCategory('mobilization')"></div>
                                        <div class="pie-segment regulatory" data-category="regulatory" onclick="event.stopPropagation(); selectCostCategory('regulatory')"></div>
                                        <div class="pie-center">
                                            <div class="center-label">P&A</div>
                                            <div class="center-sublabel">Cost Breakdown</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="pie-legend">
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('equipment')">
                                        <div class="legend-color" style="background: #3b82f6;"></div>
                                        <div class="legend-label">Equipment Rental (30%)</div>
                                    </div>
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('labor')">
                                        <div class="legend-color" style="background: #10b981;"></div>
                                        <div class="legend-label">Labor & Personnel (25%)</div>
                                    </div>
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('materials')">
                                        <div class="legend-color" style="background: #f59e0b;"></div>
                                        <div class="legend-label">Cement & Materials (20%)</div>
                                    </div>
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('testing')">
                                        <div class="legend-color" style="background: #8b5cf6;"></div>
                                        <div class="legend-label">Testing & Monitoring (10%)</div>
                                    </div>
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('mobilization')">
                                        <div class="legend-color" style="background: #ec4899;"></div>
                                        <div class="legend-label">Mobilization (10%)</div>
                                    </div>
                                    <div class="legend-item" onclick="event.stopPropagation(); selectCostCategory('regulatory')">
                                        <div class="legend-color" style="background: #14b8a6;"></div>
                                        <div class="legend-label">Regulatory & Permitting (5%)</div>
                                    </div>
                                </div>
                            </div>

                            <div class="cost-detail-panel" id="cost-details">
                                <h4 style="margin-bottom: 16px; color: var(--accent);">Select a category to see details</h4>
                                <p style="color: var(--muted);">Click on a pie segment or legend item to explore cost breakdowns for each category.</p>
                            </div>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 6px; border-left: 4px solid var(--accent);">
                            <p style="margin-bottom: 8px;"><strong>ðŸ’¡ Cost Management Insights:</strong></p>
                            <ul style="font-size: 0.9rem; margin-left: 20px; line-height: 1.8;">
                                <li><strong>Equipment:</strong> Largest single expense - wireline units, coiled tubing, workover rigs ($3K-$50K/day)</li>
                                <li><strong>Labor:</strong> Specialized crews required - cement specialists, wireline operators, supervisors</li>
                                <li><strong>Materials:</strong> Cement costs scale with well depth - deep wells need hundreds of sacks</li>
                                <li><strong>Testing:</strong> Mandatory pressure tests, logging, monitoring add 10-15% to costs</li>
                                <li><strong>Mobilization:</strong> Moving equipment to/from site - offshore logistics especially expensive</li>
                                <li><strong>Regulatory:</strong> Permits, inspections, documentation, bonding - varies by jurisdiction</li>
                            </ul>
                        </div>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Knowledge Check</div>
                        <div class="quiz-question">
                            <p>What is the purpose of financial bonds in P&A operations?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q6" value="a"> To pay worker salaries
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q6" value="b"> To guarantee funding for P&A completion
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q6" value="c"> To cover production taxes
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q6" value="d"> To fund environmental monitoring only
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); completeModule(6)">Mark Complete & Continue</button>
                    </div>
                </div>
            </div>

            <!-- Module 7 -->
            <div class="module-card locked" data-module="7" onclick="toggleModule(7)">
                <div class="module-header">
                    <div class="module-title-group">
                        <div class="module-number">MODULE 7</div>
                        <div class="module-title">The Three Golden Rules of P&A</div>
                        <div class="module-duration">ðŸ“¹ Video: 11:25 - 11:45</div>
                    </div>
                    <div class="module-status" id="status-7">
                        <span>ðŸ”’</span>
                        <span>Locked</span>
                    </div>
                </div>
                <div class="module-description">
                    Final synthesis: The three fundamental principles every P&A professional must follow.
                </div>
                <div class="module-content" id="content-7">
                    <div class="key-points">
                        <h4>The Three Golden Rules:</h4>
                        <ul>
                            <li><strong>1. Check Local Law:</strong> Regulations vary globally - always know your jurisdiction's specific requirements</li>
                            <li><strong>2. Prove Safety:</strong> Use best materials, verify all barriers, document every step meticulously</li>
                            <li><strong>3. Plan for the Future:</strong> Remember liability lasts generations - build for long-term integrity</li>
                        </ul>
                        <h4 style="margin-top: 16px;">Course Completion Criteria:</h4>
                        <ul>
                            <li>Understand prescriptive vs goal-setting regulatory frameworks</li>
                            <li>Recognize global standard ISO 16530-1 and country-specific approaches</li>
                            <li>Comprehend technical barrier systems and verification requirements</li>
                            <li>Appreciate liability in perpetuity and trailing liability concepts</li>
                            <li>Know financial assurance requirements and innovative programs</li>
                        </ul>
                    </div>

                    <!-- Interactive Three Golden Rules Checklist -->
                    <div class="interactive-section">
                        <div class="interactive-title">Interactive: Apply the Three Golden Rules</div>
                        <p style="margin-bottom: 16px; color: var(--text-secondary);">Click each rule to explore how it applies to real-world P&A planning. These are the foundational principles every professional must follow.</p>

                        <div class="golden-rules-grid">
                            <div class="golden-rule-card" onclick="event.stopPropagation(); selectGoldenRule(1)" data-rule="1">
                                <div class="rule-number">1</div>
                                <h4>Check Local Law</h4>
                                <p>Know your jurisdiction's requirements</p>
                            </div>

                            <div class="golden-rule-card" onclick="event.stopPropagation(); selectGoldenRule(2)" data-rule="2">
                                <div class="rule-number">2</div>
                                <h4>Prove Safety</h4>
                                <p>Verify, document, demonstrate</p>
                            </div>

                            <div class="golden-rule-card" onclick="event.stopPropagation(); selectGoldenRule(3)" data-rule="3">
                                <div class="rule-number">3</div>
                                <h4>Plan for the Future</h4>
                                <p>Build for generations, not decades</p>
                            </div>
                        </div>

                        <div class="rule-application reg-details" id="rule-app-1">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ“‹ Rule 1: Check Local Law</h4>
                            <p><strong>Why it matters:</strong> P&A regulations vary dramatically by jurisdiction. What's acceptable in Texas may be illegal in Norway.</p>
                            <p style="margin-top: 12px;"><strong>Practical Application:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li>Before planning: Identify all applicable federal, state/provincial, and local regulations</li>
                                <li>Determine if prescriptive (follow exact steps) or goal-setting (prove your method works)</li>
                                <li>Check for recent regulatory updates - requirements change frequently</li>
                                <li>For multi-jurisdictional projects: Apply most stringent requirements</li>
                                <li>Engage legal/regulatory experts early in planning</li>
                            </ul>
                            <p style="margin-top: 12px; padding: 12px; background: rgba(37, 99, 235, 0.1); border-radius: 6px;">
                                <strong>ðŸ’¡ Pro Tip:</strong> Create a regulatory compliance checklist specific to your well's location before designing P&A program.
                            </p>
                        </div>

                        <div class="rule-application reg-details" id="rule-app-2">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">âœ… Rule 2: Prove Safety</h4>
                            <p><strong>Why it matters:</strong> In goal-setting jurisdictions, you must scientifically demonstrate your P&A design will work forever. Even in prescriptive jurisdictions, proving safety protects you from liability.</p>
                            <p style="margin-top: 12px;"><strong>Practical Application:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><strong>Materials:</strong> Use highest quality cement, tested for downhole conditions</li>
                                <li><strong>Verification:</strong> Pressure test every barrier - don't assume success</li>
                                <li><strong>Logging:</strong> Run cement bond logs, temperature logs to confirm placement</li>
                                <li><strong>Documentation:</strong> Record everything - procedures, test results, deviations, decisions</li>
                                <li><strong>Third-party review:</strong> Have independent experts validate critical decisions</li>
                                <li><strong>Photos/video:</strong> Visual evidence of surface conditions, equipment used</li>
                            </ul>
                            <p style="margin-top: 12px; padding: 12px; background: rgba(37, 99, 235, 0.1); border-radius: 6px;">
                                <strong>ðŸ’¡ Pro Tip:</strong> Document as if you'll need to defend this work in court 50 years from now - because you might.
                            </p>
                        </div>

                        <div class="rule-application reg-details" id="rule-app-3">
                            <h4 style="color: var(--primary-color); margin-bottom: 12px;">ðŸ”® Rule 3: Plan for the Future</h4>
                            <p><strong>Why it matters:</strong> Liability is perpetual. Your company (or its successor) will be responsible for this well in 100+ years.</p>
                            <p style="margin-top: 12px;"><strong>Practical Application:</strong></p>
                            <ul style="margin-left: 20px; margin-top: 8px;">
                                <li><strong>Conservative design:</strong> Exceed minimum requirements - design for worst-case scenarios</li>
                                <li><strong>Material longevity:</strong> Will cement remain intact for centuries? Consider corrosion, pressure cycling</li>
                                <li><strong>Climate change:</strong> Could sea level rise, permafrost thaw, seismic activity affect barriers?</li>
                                <li><strong>Institutional knowledge:</strong> Create records that future generations can understand</li>
                                <li><strong>Financial planning:</strong> Set aside funds for monitoring and potential remediation</li>
                                <li><strong>Succession planning:</strong> Ensure corporate records survive mergers, bankruptcies, ownership changes</li>
                            </ul>
                            <p style="margin-top: 12px; padding: 12px; background: rgba(37, 99, 235, 0.1); border-radius: 6px;">
                                <strong>ðŸ’¡ Pro Tip:</strong> Ask yourself: "If I have to explain this decision to a regulator in 2100, will I be proud of the choices we made today?"
                            </p>
                        </div>

                        <p style="margin-top: 16px; padding: 16px; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1)); border-radius: 8px; border-left: 4px solid var(--success);">
                            <strong>ðŸŽ¯ Integration:</strong> These three rules work together. Checking local law tells you WHAT to do. Proving safety shows HOW you'll do it. Planning for the future explains WHY you're doing it this way. Master all three for successful P&A operations.
                        </p>
                    </div>

                    <div class="quiz-section">
                        <div class="quiz-title">Final Assessment</div>
                        <div class="quiz-question">
                            <p>Why is "planning for the future" critical in P&A operations?</p>
                            <div class="quiz-options">
                                <label class="quiz-option">
                                    <input type="radio" name="q7" value="a"> To reduce current operational costs
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q7" value="b"> Because liability can last for generations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q7" value="c"> To comply with short-term regulations
                                </label>
                                <label class="quiz-option">
                                    <input type="radio" name="q7" value="d"> It's only a recommendation, not a requirement
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="module-actions">
                        <button class="btn btn-success" onclick="event.stopPropagation(); completeModule(7)">Complete Course & Get Certificate</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Resources -->
        <div class="resources-section">
            <h2 class="resources-title">Related WellTegra Resources</h2>
            <div class="resource-grid">
                <div class="resource-card">
                    <h4>ðŸ”§ Bridge Plug Setting SOP</h4>
                    <p>Critical procedure for establishing P&A barriers with bridge plugs</p>
                    <a href="sop-library.html#sop_002" class="resource-link">View SOP â†’</a>
                </div>
                <div class="resource-card">
                    <h4>ðŸ”§ Bridge Plug Retrieval SOP</h4>
                    <p>Troubleshooting and retrieval procedures for complex P&A scenarios</p>
                    <a href="sop-library.html#sop_003" class="resource-link">View SOP â†’</a>
                </div>
                <div class="resource-card">
                    <h4>ðŸ“¦ Well Abandonment Package</h4>
                    <p>Pre-configured equipment assemblies for P&A operations</p>
                    <a href="equipment.html" class="resource-link">View Equipment â†’</a>
                </div>
                <div class="resource-card">
                    <h4>ðŸ“š Intervention Planning Guide</h4>
                    <p>6-phase methodology for complex well interventions</p>
                    <a href="intervention-guide.html" class="resource-link">View Guide â†’</a>
                </div>
                <div class="resource-card">
                    <h4>âš ï¸ Well 666 Case Study</h4>
                    <p>Lessons learned from "The Perfect Storm" - P&A considerations</p>
                    <a href="well-666.html" class="resource-link">View Case Study â†’</a>
                </div>
                <div class="resource-card">
                    <h4>ðŸ” Equipment Catalog</h4>
                    <p>Complete inventory of P&A tools and pressure control equipment</p>
                    <a href="equipment.html" class="resource-link">Browse Catalog â†’</a>
                </div>
            </div>
        </div>

        <!-- Certificate Section -->
        <div class="certificate-section" id="certificate">
            <h2>ðŸŽ“ Congratulations!</h2>
            <p>You have successfully completed the Plug & Abandonment Demo Course</p>
            <p><strong>Certificate ID:</strong> <span id="cert-id"></span></p>
            <p><strong>Completion Date:</strong> <span id="cert-date"></span></p>
            <button class="btn" style="background: var(--success); color: white;" onclick="event.stopPropagation(); downloadCertificate()">Download Certificate</button>
        </div>
    </div>

    <script>
        // YouTube IFrame API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;
        var checkpoints = [
            { time: 110, module: 1, title: "P&A Importance", exercise: "Explore environmental risks" },
            { time: 166, module: 2, title: "Regulatory Frameworks", exercise: "Compare regulatory approaches" },
            { time: 409, module: 3, title: "Global Standards", exercise: "Explore country regulations" },
            { time: 462, module: 4, title: "Barrier Systems", exercise: "Build a P&A barrier" },
            { time: 588, module: 5, title: "Perpetual Liability", exercise: "Explore liability timeline" },
            { time: 684, module: 6, title: "Financial Assurance", exercise: "Calculate bond requirements" },
            { time: 705, module: 7, title: "Three Golden Rules", exercise: "Review professional principles" }
        ];

        // Module start times in seconds (when each module begins in the video)
        var moduleStartTimes = {
            1: 0,      // 00:00
            2: 111,    // 01:51
            3: 167,    // 02:47
            4: 410,    // 06:50
            5: 463,    // 07:43
            6: 589,    // 09:49
            7: 685     // 11:25
        };

        var currentCheckpointIndex = 0;
        var checkpointCompleted = false;
        var videoInterval;
        var reachedCheckpoints = new Set(); // Track which module checkpoints have been reached

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '100%',
                width: '100%',
                videoId: 'V7Rn45Xjjp0',
                playerVars: {
                    'enablejsapi': 1,
                    'origin': window.location.origin
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            updateNextCheckpoint();
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                startCheckpointMonitoring();
            } else {
                stopCheckpointMonitoring();
            }
        }

        function startCheckpointMonitoring() {
            videoInterval = setInterval(() => {
                const currentTime = player.getCurrentTime();
                const nextCheckpoint = checkpoints[currentCheckpointIndex];

                if (nextCheckpoint && currentTime >= nextCheckpoint.time && !checkpointCompleted) {
                    reachCheckpoint(nextCheckpoint);
                }
            }, 1000);
        }

        function stopCheckpointMonitoring() {
            if (videoInterval) {
                clearInterval(videoInterval);
            }
        }

        function reachCheckpoint(checkpoint) {
            player.pauseVideo();
            checkpointCompleted = true;

            // Mark this module's checkpoint as reached
            reachedCheckpoints.add(checkpoint.module);
            saveProgress(); // Save checkpoint progress

            // Show checkpoint alert
            document.getElementById('checkpoint-alert').style.display = 'block';
            document.getElementById('checkpoint-message').textContent =
                `Module ${checkpoint.module}: ${checkpoint.title} - ${checkpoint.exercise}`;

            // Scroll to and highlight interactive element
            const moduleCard = document.querySelector(`[data-module="${checkpoint.module}"]`);
            if (moduleCard) {
                // Unlock and open the module
                moduleCard.classList.remove('locked');
                toggleModule(checkpoint.module);

                // Highlight the interactive section
                setTimeout(() => {
                    const interactiveSection = moduleCard.querySelector('.interactive-section');
                    if (interactiveSection) {
                        interactiveSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        interactiveSection.style.animation = 'pulse 2s infinite';
                    }
                }, 500);
            }
        }

        function continueVideo() {
            // Hide checkpoint alert
            document.getElementById('checkpoint-alert').style.display = 'none';

            // Remove highlight animation
            const allInteractive = document.querySelectorAll('.interactive-section');
            allInteractive.forEach(section => {
                section.style.animation = '';
            });

            // Move to next checkpoint
            currentCheckpointIndex++;
            checkpointCompleted = false;
            updateNextCheckpoint();

            // Scroll to video player
            const videoSection = document.querySelector('.video-section');
            if (videoSection) {
                videoSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Resume video after scroll
            setTimeout(() => {
                player.playVideo();
            }, 300);
        }

        function updateNextCheckpoint() {
            const nextCheckpoint = checkpoints[currentCheckpointIndex];
            const checkpointDiv = document.getElementById('current-checkpoint');

            if (nextCheckpoint) {
                const minutes = Math.floor(nextCheckpoint.time / 60);
                const seconds = nextCheckpoint.time % 60;
                checkpointDiv.textContent =
                    `ðŸ“ Next checkpoint: Module ${nextCheckpoint.module} at ${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                checkpointDiv.textContent = 'ðŸŽ‰ All checkpoints completed!';
            }
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#22c55e', '#10b981', '#14b8a6', '#2563eb', '#f59e0b'];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 5000);
            }
        }

        // Enable continue button when interactive element is completed
        function enableContinue() {
            const continueBtn = document.getElementById('continue-btn');
            continueBtn.disabled = false;
            continueBtn.textContent = 'â–¶ï¸ Continue Video';
            continueBtn.style.background = 'var(--success)';
            continueBtn.style.color = 'white';

            // Add visual feedback
            continueBtn.style.animation = 'successPulse 1s ease 3';

            // Show success message with animation
            const checkpointAlert = document.getElementById('checkpoint-alert');
            checkpointAlert.style.background = 'linear-gradient(135deg, var(--success), var(--secondary-color))';
            checkpointAlert.style.animation = 'bounce 0.5s ease';
        }

        // Course state management
        const courseState = {
            completedModules: new Set(),
            currentModule: null
        };

        // Load saved progress
        function loadProgress() {
            const saved = localStorage.getItem('pa-course-progress');
            if (saved) {
                const data = JSON.parse(saved);
                courseState.completedModules = new Set(data.completed || []);
                reachedCheckpoints = new Set(data.reachedCheckpoints || []);
                updateProgress();
                updateModuleStates();
            }
        }

        // Save progress
        function saveProgress() {
            localStorage.setItem('pa-course-progress', JSON.stringify({
                completed: Array.from(courseState.completedModules),
                reachedCheckpoints: Array.from(reachedCheckpoints),
                lastAccess: new Date().toISOString()
            }));
        }

        // Toggle module content
        function toggleModule(moduleNum) {
            console.log('toggleModule called for module:', moduleNum);

            const card = document.querySelector(`[data-module="${moduleNum}"]`);
            const content = document.getElementById(`content-${moduleNum}`);
            const status = document.getElementById(`status-${moduleNum}`);

            // Check if module is locked - must have reached video checkpoint
            if (!reachedCheckpoints.has(moduleNum)) {
                alert(`ðŸ”’ Please watch the video to unlock Module ${moduleNum}\n\nThis module will automatically unlock when the video reaches the corresponding section.`);
                return;
            }

            // Toggle content
            const isActive = content.classList.contains('active');

            // Close all other modules
            document.querySelectorAll('.module-content').forEach(c => c.classList.remove('active'));

            if (!isActive) {
                content.classList.add('active');

                // Mark as in progress if not completed
                if (!courseState.completedModules.has(moduleNum)) {
                    card.classList.add('in-progress');
                    status.innerHTML = '<span>â³</span><span>In Progress</span>';
                    status.className = 'module-status in-progress';

                    // Only seek video if NOT at a checkpoint (to avoid restarting video)
                    const checkpointAlert = document.getElementById('checkpoint-alert');
                    const isAtCheckpoint = checkpointAlert && checkpointAlert.style.display !== 'none';

                    // If module not completed AND not at an active checkpoint, start video
                    if (!isAtCheckpoint && player && player.seekTo && moduleStartTimes[moduleNum] !== undefined) {
                        // Scroll to video first
                        const videoSection = document.querySelector('.video-section');
                        if (videoSection) {
                            videoSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }

                        // Seek to module start time and play
                        setTimeout(() => {
                            player.seekTo(moduleStartTimes[moduleNum], true);
                            player.playVideo();
                            console.log(`Video started at ${moduleStartTimes[moduleNum]}s for Module ${moduleNum}`);
                        }, 800);
                    } else if (isAtCheckpoint) {
                        // At checkpoint - just scroll to module, don't touch video
                        setTimeout(() => {
                            card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    }
                } else {
                    // If already completed, just scroll to the module
                    setTimeout(() => {
                        card.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            }
        }

        // Complete module
        function completeModule(moduleNum) {
            console.log('completeModule called for module:', moduleNum);

            // Check if video checkpoint was reached for this module
            if (!reachedCheckpoints.has(moduleNum)) {
                alert(`ðŸ”’ You must watch the video to unlock this module first!\n\nThe video will automatically pause at Module ${moduleNum} for you to complete the interactive exercises.`);
                return;
            }

            // Check quiz answer
            const correctAnswers = {
                1: 'b', 2: 'b', 3: 'b', 4: 'a', 5: 'b', 6: 'b', 7: 'b'
            };

            const selected = document.querySelector(`input[name="q${moduleNum}"]:checked`);
            if (!selected) {
                alert('Please answer the knowledge check question');
                return;
            }

            const options = document.querySelectorAll(`input[name="q${moduleNum}"]`);
            let isCorrect = false;

            options.forEach(opt => {
                const label = opt.parentElement;
                label.classList.remove('selected', 'correct', 'incorrect');
                if (opt.checked) {
                    label.classList.add('selected');
                    if (opt.value === correctAnswers[moduleNum]) {
                        label.classList.add('correct');
                        isCorrect = true;
                    } else {
                        label.classList.add('incorrect');
                    }
                }
            });

            if (!isCorrect) {
                alert('âŒ Incorrect answer. Please review the module content and try again.\n\nTip: The correct information can be found in the interactive sections above.');
                // Uncheck the incorrect answer so they can select a new one
                selected.checked = false;
                options.forEach(opt => {
                    opt.parentElement.classList.remove('selected', 'correct', 'incorrect');
                });
                return;
            }

            // Mark as completed
            courseState.completedModules.add(moduleNum);
            const card = document.querySelector(`[data-module="${moduleNum}"]`);
            const status = document.getElementById(`status-${moduleNum}`);

            card.classList.remove('in-progress');
            card.classList.add('completed');
            status.innerHTML = '<span>âœ…</span><span>Completed</span>';
            status.className = 'module-status completed';

            // Add visual celebration
            createConfetti();
            card.style.animation = 'successPulse 0.5s ease';

            // Check if this module completion should resume the video
            const checkpointAlert = document.getElementById('checkpoint-alert');
            const continueBtn = document.getElementById('continue-btn');
            let willResumeVideo = false;

            // If a checkpoint is active, check if it's for this module
            if (checkpointAlert.style.display !== 'none' && currentCheckpointIndex < checkpoints.length) {
                const currentCheckpoint = checkpoints[currentCheckpointIndex];
                if (currentCheckpoint && currentCheckpoint.module === moduleNum) {
                    willResumeVideo = true;
                    // Enable continue button and show completion message
                    continueBtn.disabled = false;
                    continueBtn.textContent = 'â–¶ï¸ Continue Video';
                    continueBtn.style.background = 'linear-gradient(135deg, var(--accent), var(--primary-color))';
                    continueBtn.style.color = 'white';

                    // Automatically resume video after a short celebration
                    setTimeout(() => {
                        continueVideo();
                    }, 1500);
                }
            }

            // Close current module
            document.getElementById(`content-${moduleNum}`).classList.remove('active');

            // Only auto-open next module if NOT resuming video
            // (video will handle opening next module at next checkpoint)
            if (!willResumeVideo && moduleNum < 7) {
                const nextCard = document.querySelector(`[data-module="${moduleNum + 1}"]`);
                nextCard.classList.remove('locked');
                nextCard.style.animation = 'fadeInUp 0.5s ease';
                document.getElementById(`status-${moduleNum + 1}`).innerHTML = '<span>â­•</span><span>Not Started</span>';
                document.getElementById(`status-${moduleNum + 1}`).className = 'module-status';

                // Automatically open next module and scroll to it
                setTimeout(() => {
                    toggleModule(moduleNum + 1);
                }, 600);
            } else if (moduleNum < 7) {
                // Still unlock next module, but don't auto-open it
                const nextCard = document.querySelector(`[data-module="${moduleNum + 1}"]`);
                nextCard.classList.remove('locked');
                document.getElementById(`status-${moduleNum + 1}`).innerHTML = '<span>â­•</span><span>Not Started</span>';
                document.getElementById(`status-${moduleNum + 1}`).className = 'module-status';
            }

            // Update progress
            updateProgress();
            saveProgress();

            // Check if course completed
            if (moduleNum === 7) {
                showCertificate();
            }
        }

        // Update progress bar
        function updateProgress() {
            const total = 7;
            const completed = courseState.completedModules.size;
            const percent = Math.round((completed / total) * 100);

            const percentEl = document.getElementById('progress-percent');
            const fillEl = document.getElementById('progress-fill');

            percentEl.textContent = `${percent}%`;
            percentEl.style.animation = 'successPulse 0.5s ease';

            fillEl.style.width = `${percent}%`;
            fillEl.style.animation = 'shimmer 2s infinite';

            // Add glow effect when progress increases
            const progressBar = document.querySelector('.progress-bar');
            progressBar.style.boxShadow = '0 0 20px rgba(20, 184, 166, 0.4)';
            setTimeout(() => {
                progressBar.style.boxShadow = '';
            }, 1000);
        }

        // Update module states on load
        function updateModuleStates() {
            // Mark completed modules
            courseState.completedModules.forEach(moduleNum => {
                const card = document.querySelector(`[data-module="${moduleNum}"]`);
                const status = document.getElementById(`status-${moduleNum}`);

                card.classList.add('completed');
                status.innerHTML = '<span>âœ…</span><span>Completed</span>';
                status.className = 'module-status completed';
            });

            // Unlock modules that have reached their video checkpoint
            reachedCheckpoints.forEach(moduleNum => {
                const card = document.querySelector(`[data-module="${moduleNum}"]`);
                if (card) {
                    card.classList.remove('locked');
                }
            });
        }

        // Show certificate
        function showCertificate() {
            const certSection = document.getElementById('certificate');
            const certId = 'PA-' + Date.now().toString(36).toUpperCase();
            const certDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            document.getElementById('cert-id').textContent = certId;
            document.getElementById('cert-date').textContent = certDate;
            certSection.classList.add('show');
            certSection.style.animation = 'fadeInUp 1s ease';
            certSection.scrollIntoView({ behavior: 'smooth' });

            // Big confetti celebration for course completion
            createConfetti();
            setTimeout(() => createConfetti(), 1000);
            setTimeout(() => createConfetti(), 2000);

            // Save certificate data
            localStorage.setItem('pa-course-certificate', JSON.stringify({
                id: certId,
                date: certDate,
                completed: new Date().toISOString()
            }));
        }

        // Download certificate
        function downloadCertificate() {
            alert('Certificate download functionality would generate a PDF certificate with your completion details.');
            // In production, this would trigger PDF generation
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();

            // Check if already completed
            const cert = localStorage.getItem('pa-course-certificate');
            if (cert) {
                const data = JSON.parse(cert);
                document.getElementById('cert-id').textContent = data.id;
                document.getElementById('cert-date').textContent = data.date;
                document.getElementById('certificate').classList.add('show');
            }
        });

        // ============================================
        // INTERACTIVE ELEMENTS
        // ============================================

        // Before/After Slider (Module 1)
        document.addEventListener('DOMContentLoaded', () => {
            const slider = document.getElementById('beforeAfterSlider');
            const handle = document.getElementById('sliderHandle');
            const afterImage = document.getElementById('afterImage');

            if (slider && handle && afterImage) {
                let isDragging = false;

                function updateSlider(x) {
                    const rect = slider.getBoundingClientRect();
                    let position = ((x - rect.left) / rect.width) * 100;
                    position = Math.max(0, Math.min(100, position));

                    handle.style.left = position + '%';
                    afterImage.style.clipPath = `inset(0 ${100 - position}% 0 0)`;
                }

                handle.addEventListener('mousedown', (e) => {
                    e.stopPropagation();
                    isDragging = true;
                });

                document.addEventListener('mousemove', (e) => {
                    if (isDragging) {
                        updateSlider(e.clientX);
                    }
                });

                document.addEventListener('mouseup', () => {
                    isDragging = false;
                });

                // Touch support
                handle.addEventListener('touchstart', (e) => {
                    e.stopPropagation();
                    isDragging = true;
                });

                document.addEventListener('touchmove', (e) => {
                    if (isDragging && e.touches[0]) {
                        updateSlider(e.touches[0].clientX);
                    }
                });

                document.addEventListener('touchend', () => {
                    isDragging = false;
                });

                // Click anywhere on slider to move
                slider.addEventListener('click', (e) => {
                    e.stopPropagation();
                    updateSlider(e.clientX);
                });
            }
        });

        // Well Depth Visualizer (Module 1)
        function selectDepth(depth) {
            // Remove all active states from depth markers
            document.querySelectorAll('.depth-marker').forEach(marker => {
                marker.classList.remove('active');
                marker.style.transform = 'scale(1)';
                marker.style.background = 'rgba(15, 23, 42, 0.9)';
            });

            // Hide all depth info panels
            document.querySelectorAll('.depth-info').forEach(info => {
                info.classList.remove('active');
                info.style.display = 'none';
            });

            // Activate selected depth marker with animation
            const marker = document.querySelector(`[data-depth="${depth}"]`);
            if (marker) {
                marker.classList.add('active');
                marker.style.transform = 'scale(1.05)';
                marker.style.background = 'rgba(20, 184, 166, 0.2)';
                marker.style.borderColor = 'var(--accent)';
                marker.style.boxShadow = '0 0 20px rgba(20, 184, 166, 0.3)';
            }

            // Show selected depth info with smooth transition
            const info = document.getElementById(`depth-${depth}`);
            if (info) {
                info.style.display = 'block';
                setTimeout(() => {
                    info.classList.add('active');
                }, 10);
            }
        }

        // Cement Volume Calculator (Module 4)
        function calculateCement() {
            // Get input values
            const holeDiameter = parseFloat(document.getElementById('hole-diameter').value) || 0;
            const plugLength = parseFloat(document.getElementById('plug-length').value) || 0;
            const casingOD = parseFloat(document.getElementById('casing-od').value) || 0;
            const safetyFactor = parseFloat(document.getElementById('safety-factor').value) || 0;

            // Calculate volumes in cubic feet
            // Formula: Volume = Ï€ Ã— rÂ² Ã— h
            const holeRadius = holeDiameter / 2 / 12; // Convert inches to feet
            const casingRadius = casingOD / 2 / 12; // Convert inches to feet

            // Hole volume (total cylinder volume)
            const holeVolume = Math.PI * Math.pow(holeRadius, 2) * plugLength;

            // Annular volume (volume between casing and hole)
            let annularVolume = 0;
            if (casingOD > 0 && casingOD < holeDiameter) {
                annularVolume = Math.PI * (Math.pow(holeRadius, 2) - Math.pow(casingRadius, 2)) * plugLength;
            }

            // Use annular volume if casing present, otherwise use hole volume
            const baseVolume = casingOD > 0 ? annularVolume : holeVolume;

            // Cement yield: 1 sack (94 lb) of Class H cement = 1.15 cubic feet
            const cementYield = 1.15;
            const baseCementSacks = baseVolume / cementYield;

            // Apply safety factor
            const totalCementSacks = baseCementSacks * (1 + safetyFactor / 100);

            // Calculate cost and weight
            const costPerSack = 15; // $15 per sack
            const totalCost = totalCementSacks * costPerSack;
            const totalWeight = totalCementSacks * 94; // 94 lbs per sack

            // Update display
            document.getElementById('hole-volume').textContent = holeVolume.toFixed(2);
            document.getElementById('annular-volume').textContent = annularVolume.toFixed(2);
            document.getElementById('base-cement').textContent = Math.ceil(baseCementSacks);
            document.getElementById('total-cement').textContent = Math.ceil(totalCementSacks);
            document.getElementById('cement-cost').textContent = '$' + totalCost.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            document.getElementById('cement-weight').textContent = totalWeight.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');

            // Add visual feedback animation
            const results = document.getElementById('cement-results');
            results.style.animation = 'none';
            setTimeout(() => {
                results.style.animation = 'fadeInUp 0.5s ease';
            }, 10);
        }

        // Initialize calculator with default values on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Calculate initial values
            if (document.getElementById('hole-diameter')) {
                calculateCement();
            }
        });

        // P&A Decision Tree (Module 2)
        let decisionData = {
            location: '',
            wellType: '',
            depth: '',
            aquifer: '',
            locationLabel: '',
            wellTypeLabel: '',
            depthLabel: '',
            aquiferLabel: ''
        };

        function nextDecision(slideNum, dataKey, dataLabel) {
            // Store the decision
            const currentSlide = document.querySelector('.decision-slide.active');
            const slideId = currentSlide.id;

            if (slideId === 'slide-1') {
                decisionData.location = dataKey;
                decisionData.locationLabel = dataLabel;
            } else if (slideId === 'slide-2') {
                decisionData.wellType = dataKey;
                decisionData.wellTypeLabel = dataLabel;
            } else if (slideId === 'slide-3') {
                decisionData.depth = dataKey;
                decisionData.depthLabel = dataLabel;
            }

            // Update breadcrumb
            updateBreadcrumb();

            // Hide current slide
            currentSlide.classList.remove('active');

            // Show next slide
            const nextSlide = document.getElementById('slide-' + slideNum);
            if (nextSlide) {
                setTimeout(() => {
                    nextSlide.classList.add('active');
                }, 100);
            }
        }

        function showResult(aquiferStatus) {
            decisionData.aquifer = aquiferStatus;
            decisionData.aquiferLabel = aquiferStatus === 'aquifer-yes' ? 'Aquifers Present' :
                                        aquiferStatus === 'aquifer-no' ? 'No Aquifers' : 'Aquifer Status Unknown';

            updateBreadcrumb();

            // Hide current slide
            document.querySelector('.decision-slide.active').classList.remove('active');

            // Generate result based on decisions
            const resultHTML = generateResultHTML();
            document.getElementById('result-summary').innerHTML = resultHTML;

            // Show result
            setTimeout(() => {
                document.getElementById('decision-result').classList.add('active');
            }, 100);
        }

        function generateResultHTML() {
            let html = '<div>';

            // Regulatory Framework
            html += '<div class="requirement-item">';
            html += '<h5>ðŸ“‹ Regulatory Framework</h5>';
            if (decisionData.location === 'usa') {
                html += '<p><strong>Prescriptive Regulations Apply</strong></p>';
                html += '<p>U.S. regulations typically provide detailed, step-by-step requirements. You must follow specific procedures including:</p>';
                html += '<ul>';
                html += '<li>Exact cement plug lengths as specified by state regulations</li>';
                html += '<li>Mandatory pressure testing of barriers</li>';
                html += '<li>Required documentation and reporting to state oil & gas commission</li>';
                html += '<li>Possible bond requirements for proper abandonment</li>';
                html += '</ul>';
            } else if (decisionData.location === 'uk' || decisionData.location === 'norway') {
                html += '<p><strong>Goal-Setting Regulations Apply</strong></p>';
                html += '<p>UK/Norway regulations require achieving permanent isolation without dictating exact methods. You must:</p>';
                html += '<ul>';
                html += '<li>Demonstrate your P&A method will achieve permanent seal</li>';
                html += '<li>Provide rigorous engineering justification</li>';
                html += '<li>Meet "rock-to-rock" barrier requirements</li>';
                html += '<li>Submit detailed abandonment plans for approval</li>';
                html += '</ul>';
            } else {
                html += '<p><strong>Local Regulations</strong></p>';
                html += '<p>Consult your local regulatory authority for specific requirements. Most jurisdictions follow either prescriptive (detailed steps) or goal-setting (proven outcomes) approaches.</p>';
            }
            html += '</div>';

            // Well-Specific Requirements
            html += '<div class="requirement-item">';
            html += '<h5>â›½ Well-Specific Requirements</h5>';
            html += '<p><strong>Well Type:</strong> ' + decisionData.wellTypeLabel + '</p>';

            if (decisionData.wellType === 'gas') {
                html += '<p>Gas wells require extra attention to prevent methane migration. Expect enhanced monitoring and potentially more cement barriers.</p>';
            } else if (decisionData.wellType === 'injection') {
                html += '<p>Injection wells often require EPA approval and additional environmental safeguards due to waste disposal history.</p>';
            }

            html += '<p><strong>Depth:</strong> ' + decisionData.depthLabel + '</p>';
            if (decisionData.depth === 'ultra-deep' || decisionData.depth === 'deep') {
                html += '<p>Deep wells require specialized equipment, high-temperature cement, and typically multiple barrier intervals.</p>';
            } else if (decisionData.depth === 'shallow') {
                html += '<p>Shallow wells are simpler but aquifer protection is paramount. Surface plug and aquifer isolation are critical.</p>';
            }
            html += '</div>';

            // Environmental Protection
            if (decisionData.aquifer === 'aquifer-yes' || decisionData.aquifer === 'aquifer-unknown') {
                html += '<div class="requirement-item">';
                html += '<h5>ðŸ’§ Environmental Protection - CRITICAL</h5>';
                html += '<p><strong>Freshwater Aquifer Status:</strong> ' + decisionData.aquiferLabel + '</p>';
                html += '<p style="color: var(--danger); font-weight: bold;">âš ï¸ HIGHEST PRIORITY: Aquifer isolation is mandatory.</p>';
                html += '<ul>';
                html += '<li>Cement plug MUST extend 100+ feet across aquifer zone</li>';
                html += '<li>Pressure testing required to verify seal integrity</li>';
                html += '<li>Zero tolerance for leakage into drinking water sources</li>';
                if (decisionData.aquifer === 'aquifer-unknown') {
                    html += '<li style="color: var(--warning);">âš ï¸ Geological survey required to identify aquifer locations before proceeding</li>';
                }
                html += '</ul>';
                html += '</div>';
            }

            // Cost Estimate
            html += '<div class="cost-estimate">';
            html += '<h5>ðŸ’° Estimated P&A Cost Range</h5>';
            let costRange = '';
            if (decisionData.depth === 'shallow') {
                costRange = '$50,000 - $200,000';
            } else if (decisionData.depth === 'medium') {
                costRange = '$150,000 - $500,000';
            } else if (decisionData.depth === 'deep') {
                costRange = '$500,000 - $2,000,000';
            } else if (decisionData.depth === 'ultra-deep') {
                costRange = '$2,000,000 - $10,000,000+';
            }
            html += '<p><strong>' + costRange + '</strong></p>';
            html += '<p style="font-size: 0.9rem; margin-top: 8px;">Costs vary based on well complexity, equipment needs, location accessibility, and regulatory requirements. Deep wells with aquifer protection needs are most expensive.</p>';
            html += '</div>';

            // Next Steps
            html += '<div class="requirement-item">';
            html += '<h5>âœ… Next Steps</h5>';
            html += '<ol style="margin-left: 20px;">';
            html += '<li>Consult qualified P&A engineer and local regulatory authority</li>';
            html += '<li>Obtain well records and geological surveys</li>';
            if (decisionData.aquifer === 'aquifer-unknown') {
                html += '<li>Commission aquifer mapping study</li>';
            }
            html += '<li>Develop detailed P&A plan and submit for regulatory approval</li>';
            html += '<li>Secure bonding/financial assurance as required</li>';
            html += '<li>Contract specialized P&A service company</li>';
            html += '<li>Execute P&A operations with required monitoring</li>';
            html += '<li>Submit final abandonment report and documentation</li>';
            html += '</ol>';
            html += '</div>';

            html += '</div>';
            return html;
        }

        function updateBreadcrumb() {
            const trail = [];
            if (decisionData.locationLabel) trail.push(decisionData.locationLabel);
            if (decisionData.wellTypeLabel) trail.push(decisionData.wellTypeLabel);
            if (decisionData.depthLabel) trail.push(decisionData.depthLabel);
            if (decisionData.aquiferLabel) trail.push(decisionData.aquiferLabel);

            document.getElementById('breadcrumb-trail').textContent = trail.join(' â†’ ') || 'None yet';
        }

        function resetDecisionTree() {
            // Clear data
            decisionData = {
                location: '',
                wellType: '',
                depth: '',
                aquifer: '',
                locationLabel: '',
                wellTypeLabel: '',
                depthLabel: '',
                aquiferLabel: ''
            };

            // Hide result
            document.getElementById('decision-result').classList.remove('active');

            // Hide all slides
            document.querySelectorAll('.decision-slide').forEach(slide => {
                slide.classList.remove('active');
            });

            // Show first slide
            setTimeout(() => {
                document.getElementById('slide-1').classList.add('active');
            }, 100);

            // Reset breadcrumb
            document.getElementById('breadcrumb-trail').textContent = 'None yet';
        }

        // Barrier Sequence Builder (Module 4)
        let selectedSlot = null;
        let draggedBarrier = null;

        function addBarrier(barrierType, barrierName, barrierIcon) {
            console.log('addBarrier called:', barrierType, barrierName);

            // Find appropriate slot for this barrier type
            let targetSlot = null;

            if (barrierType === 'bridge-plug') {
                targetSlot = document.getElementById('slot-bottom');
            } else if (barrierType === 'cement-plug') {
                // Try production first, then intermediate
                const productionSlot = document.getElementById('slot-production');
                const intermediateSlot = document.getElementById('slot-intermediate');
                if (!productionSlot.classList.contains('filled')) {
                    targetSlot = productionSlot;
                } else if (!intermediateSlot.classList.contains('filled')) {
                    targetSlot = intermediateSlot;
                }
            } else if (barrierType === 'aquifer-seal') {
                targetSlot = document.getElementById('slot-aquifer');
            } else if (barrierType === 'surface-plug') {
                targetSlot = document.getElementById('slot-surface');
            }

            if (!targetSlot) {
                showFeedback('âš ï¸ No available slot for this barrier type. Try a different barrier or reset the sequence.', 'warning');
                return;
            }

            if (targetSlot.classList.contains('filled')) {
                showFeedback('âš ï¸ This slot is already filled. Click "Reset Sequence" to try again.', 'warning');
                return;
            }

            // Add barrier to slot
            targetSlot.classList.add('filled');
            targetSlot.setAttribute('data-barrier-type', barrierType);
            targetSlot.innerHTML = `
                <div class="barrier-item" style="animation: fadeInUp 0.5s ease;">
                    <span class="icon" style="font-size: 1.5rem;">${barrierIcon}</span>
                    <span style="font-weight: 600; margin-left: 8px;">${barrierName}</span>
                </div>
            `;

            // Visual feedback
            targetSlot.style.background = 'rgba(20, 184, 166, 0.2)';
            targetSlot.style.border = '2px solid var(--accent)';

            showFeedback(`âœ… ${barrierName} added successfully!`, 'success');
        }

        // Initialize drag and drop for barrier types
        function initializeBarrierDragDrop() {
            const barrierCards = document.querySelectorAll('.barrier-type-card');
            const barrierSlots = document.querySelectorAll('.barrier-slot');

            barrierCards.forEach(card => {
                card.setAttribute('draggable', 'true');

                card.addEventListener('dragstart', (e) => {
                    e.stopPropagation();
                    const barrierType = card.getAttribute('data-barrier');
                    draggedBarrier = {
                        type: barrierType,
                        name: card.querySelector('strong').textContent,
                        icon: card.querySelector('div').textContent
                    };
                    card.style.opacity = '0.5';
                });

                card.addEventListener('dragend', (e) => {
                    card.style.opacity = '1';
                    draggedBarrier = null;
                });
            });

            barrierSlots.forEach(slot => {
                slot.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!slot.classList.contains('filled')) {
                        slot.style.background = 'rgba(20, 184, 166, 0.15)';
                        slot.style.border = '2px dashed var(--accent)';
                    }
                });

                slot.addEventListener('dragleave', (e) => {
                    e.stopPropagation();
                    if (!slot.classList.contains('filled')) {
                        slot.style.background = '';
                        slot.style.border = '';
                    }
                });

                slot.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    if (draggedBarrier && !slot.classList.contains('filled')) {
                        // Check if this is the correct slot for this barrier type
                        const slotId = slot.id;
                        let isCorrectSlot = false;

                        if (draggedBarrier.type === 'bridge-plug' && slotId === 'slot-bottom') {
                            isCorrectSlot = true;
                        } else if (draggedBarrier.type === 'aquifer-seal' && slotId === 'slot-aquifer') {
                            isCorrectSlot = true;
                        } else if (draggedBarrier.type === 'surface-plug' && slotId === 'slot-surface') {
                            isCorrectSlot = true;
                        } else if (draggedBarrier.type === 'cement-plug' &&
                                   (slotId === 'slot-production' || slotId === 'slot-intermediate')) {
                            isCorrectSlot = true;
                        }

                        if (isCorrectSlot) {
                            slot.classList.add('filled');
                            slot.setAttribute('data-barrier-type', draggedBarrier.type);
                            slot.innerHTML = `
                                <div class="barrier-item" style="animation: fadeInUp 0.5s ease;">
                                    <span class="icon" style="font-size: 1.5rem;">${draggedBarrier.icon}</span>
                                    <span style="font-weight: 600; margin-left: 8px;">${draggedBarrier.name}</span>
                                </div>
                            `;
                            slot.style.background = 'rgba(20, 184, 166, 0.2)';
                            slot.style.border = '2px solid var(--accent)';
                            showFeedback(`âœ… ${draggedBarrier.name} placed successfully!`, 'success');
                        } else {
                            slot.style.background = '';
                            slot.style.border = '';
                            showFeedback(`âŒ ${draggedBarrier.name} cannot be placed in this zone. Try the correct depth zone.`, 'warning');
                        }
                    }
                });
            });
        }

        // Initialize drag-and-drop when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeBarrierDragDrop();
        });

        function resetSequence() {
            // Clear all slots
            document.querySelectorAll('.barrier-slot').forEach(slot => {
                slot.classList.remove('filled');
                slot.removeAttribute('data-barrier-type');
                slot.innerHTML = '';
                slot.style.animation = '';
                slot.style.background = '';
                slot.style.border = '';
            });

            // Hide feedback
            document.getElementById('sequence-feedback').style.display = 'none';
        }

        function validateSequence() {
            const feedback = document.getElementById('sequence-feedback');
            const slots = {
                bottom: document.getElementById('slot-bottom'),
                production: document.getElementById('slot-production'),
                intermediate: document.getElementById('slot-intermediate'),
                aquifer: document.getElementById('slot-aquifer'),
                surface: document.getElementById('slot-surface')
            };

            // Check which barriers are placed
            const filled = {
                bottom: slots.bottom.classList.contains('filled'),
                production: slots.production.classList.contains('filled'),
                intermediate: slots.intermediate.classList.contains('filled'),
                aquifer: slots.aquifer.classList.contains('filled'),
                surface: slots.surface.classList.contains('filled')
            };

            let messages = [];
            let isValid = true;

            // Critical checks
            if (!filled.bottom) {
                messages.push('âŒ Missing bottom bridge plug - required to support cement above');
                isValid = false;
            }

            if (!filled.aquifer) {
                messages.push('âŒ CRITICAL: Missing aquifer seal - protecting drinking water is mandatory!');
                isValid = false;
            }

            if (!filled.surface) {
                messages.push('âŒ Missing surface plug - required to seal wellhead');
                isValid = false;
            }

            if (!filled.production) {
                messages.push('âš ï¸ Missing production zone cement - recommended for proper sealing');
            }

            if (!filled.intermediate) {
                messages.push('âš ï¸ Missing intermediate cement - provides valuable redundancy');
            }

            // Show results
            if (isValid && filled.bottom && filled.production && filled.intermediate && filled.aquifer && filled.surface) {
                feedback.style.background = 'rgba(34, 197, 94, 0.1)';
                feedback.style.borderLeft = '4px solid var(--success)';
                feedback.innerHTML = `
                    <h5 style="color: var(--success); margin-bottom: 12px;">âœ… Perfect P&A Sequence!</h5>
                    <p>You've built a complete multi-barrier P&A system with all essential components:</p>
                    <ul style="margin-left: 20px; margin-top: 8px; line-height: 1.8;">
                        <li>Bottom bridge plug providing foundation</li>
                        <li>Production zone sealed against hydrocarbon migration</li>
                        <li>Intermediate barrier for redundancy</li>
                        <li>Aquifer protected with dedicated seal</li>
                        <li>Surface plug completing the abandonment</li>
                    </ul>
                    <p style="margin-top: 12px; font-weight: bold;">This meets industry best practices and regulatory standards!</p>
                `;
            } else if (isValid) {
                feedback.style.background = 'rgba(234, 179, 8, 0.1)';
                feedback.style.borderLeft = '4px solid var(--warning)';
                feedback.innerHTML = `
                    <h5 style="color: var(--warning); margin-bottom: 12px;">âš ï¸ Meets Minimum Requirements</h5>
                    <p>Your sequence includes the critical barriers, but could be improved:</p>
                    <ul style="margin-left: 20px; margin-top: 8px; line-height: 1.6;">
                        ${messages.map(msg => `<li>${msg}</li>`).join('')}
                    </ul>
                    <p style="margin-top: 12px;">Consider adding intermediate barriers for redundancy and enhanced safety.</p>
                `;
            } else {
                feedback.style.background = 'rgba(239, 68, 68, 0.1)';
                feedback.style.borderLeft = '4px solid var(--danger)';

                // Generate specific advice based on what's missing
                let advice = '';
                if (!filled.bottom) {
                    advice += '<p style="margin-top: 12px;"><strong>ðŸ’¡ How to fix:</strong> Click "Add to Sequence" on the <strong>Bridge Plug</strong> button to place it at the bottom (8,000 ft).</p>';
                } else if (!filled.aquifer) {
                    advice += '<p style="margin-top: 12px;"><strong>ðŸ’¡ How to fix:</strong> Click "Add to Sequence" on the <strong>Aquifer Seal</strong> button to protect the drinking water zone.</p>';
                } else if (!filled.surface) {
                    advice += '<p style="margin-top: 12px;"><strong>ðŸ’¡ How to fix:</strong> Click "Add to Sequence" on the <strong>Surface Plug</strong> button to seal the wellhead.</p>';
                } else {
                    advice += '<p style="margin-top: 12px;"><strong>ðŸ’¡ How to fix:</strong> Review the list above and add the missing barriers using the buttons on the left.</p>';
                }

                feedback.innerHTML = `
                    <h5 style="color: var(--danger); margin-bottom: 12px;">âŒ Incomplete Sequence - Regulatory Failure</h5>
                    <p style="font-weight: 600;">Your P&A sequence is missing critical barriers:</p>
                    <ul style="margin-left: 20px; margin-top: 8px; line-height: 1.8;">
                        ${messages.map(msg => `<li>${msg}</li>`).join('')}
                    </ul>
                    ${advice}
                    <p style="margin-top: 12px; padding: 10px; background: rgba(239, 68, 68, 0.15); border-radius: 6px; font-weight: 600;">
                        âš ï¸ This sequence would be rejected by regulatory authorities and could result in environmental contamination.
                    </p>
                `;
            }

            feedback.style.display = 'block';
            feedback.style.animation = 'fadeInUp 0.5s ease';
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('sequence-feedback');
            if (type === 'success') {
                feedback.style.background = 'rgba(34, 197, 94, 0.1)';
                feedback.style.borderLeft = '4px solid var(--success)';
            } else {
                feedback.style.background = 'rgba(234, 179, 8, 0.1)';
                feedback.style.borderLeft = '4px solid var(--warning)';
            }
            feedback.innerHTML = `<p>${message}</p>`;
            feedback.style.display = 'block';

            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }

        // Pressure Test Simulator (Module 4)
        let testInterval = null;
        let testStartTime = null;

        function startPressureTest() {
            const targetPressure = parseInt(document.getElementById('target-pressure').value);
            const duration = parseInt(document.getElementById('test-duration').value);
            const quality = document.getElementById('plug-quality').value;

            // Reset previous test
            resetPressureTest();

            // Show test UI
            document.getElementById('pressure-arrows').style.display = 'flex';
            document.getElementById('test-progress').style.display = 'block';
            document.getElementById('cement-plug').classList.add('under-pressure');

            // Disable start button
            document.getElementById('start-test-btn').disabled = true;

            testStartTime = Date.now();
            const testDurationMs = duration * 1000; // Convert to ms for simulation (1 min = 1 sec)
            let currentPressure = 0;
            let pressureDropRate = 0;

            // Determine leak rate based on quality
            if (quality === 'poor') {
                pressureDropRate = targetPressure / (testDurationMs / 100) * 3; // Fails quickly
            } else if (quality === 'fair') {
                pressureDropRate = targetPressure / (testDurationMs / 100) * 0.8; // Gradual failure
            } else if (quality === 'good') {
                pressureDropRate = targetPressure / (testDurationMs / 100) * 0.1; // Minor drop
            } else {
                pressureDropRate = 0; // No drop - perfect
            }

            // Ramp up pressure
            let rampInterval = setInterval(() => {
                currentPressure += targetPressure / 20;
                if (currentPressure >= targetPressure) {
                    currentPressure = targetPressure;
                    clearInterval(rampInterval);

                    // Start main test
                    startMainTest(targetPressure, testDurationMs, pressureDropRate, quality);
                }
                document.getElementById('current-pressure').textContent = Math.round(currentPressure);
            }, 100);
        }

        function startMainTest(targetPressure, testDurationMs, pressureDropRate, quality) {
            let elapsed = 0;
            let currentPressure = targetPressure;

            testInterval = setInterval(() => {
                elapsed += 100;
                const progress = (elapsed / testDurationMs) * 100;

                // Update progress bar
                document.getElementById('progress-fill').style.width = progress + '%';
                document.getElementById('progress-time').textContent = Math.round(progress) + '%';

                // Apply pressure drop
                currentPressure -= pressureDropRate;
                currentPressure = Math.max(0, currentPressure);
                document.getElementById('current-pressure').textContent = Math.round(currentPressure);

                // Show leaks for poor/fair quality
                if (quality === 'poor' && elapsed > testDurationMs * 0.2) {
                    showLeaks(3);
                } else if (quality === 'fair' && elapsed > testDurationMs * 0.5) {
                    showLeaks(1);
                }

                // Test complete
                if (elapsed >= testDurationMs) {
                    clearInterval(testInterval);
                    showTestResults(targetPressure, currentPressure, quality);
                }
            }, 100);
        }

        function showLeaks(count) {
            const container = document.getElementById('leak-indicators');
            if (container.children.length > 0) return; // Already showing leaks

            for (let i = 0; i < count; i++) {
                const leak = document.createElement('div');
                leak.className = 'leak';
                leak.textContent = 'ðŸ’§';
                leak.style.left = (30 + Math.random() * 40) + '%';
                leak.style.top = (20 + Math.random() * 60) + '%';
                container.appendChild(leak);
            }
        }

        function showTestResults(targetPressure, finalPressure, quality) {
            const results = document.getElementById('test-results');
            const pressureDrop = targetPressure - finalPressure;
            const dropPercentage = (pressureDrop / targetPressure) * 100;

            let status, message, bgColor, borderColor;

            if (dropPercentage <= 1) {
                // Pass - excellent
                status = 'âœ… TEST PASSED';
                message = `
                    <p><strong>Result:</strong> Barrier integrity confirmed! Pressure held at ${Math.round(finalPressure)} PSI with only ${Math.round(pressureDrop)} PSI drop (${dropPercentage.toFixed(1)}%).</p>
                    <p style="margin-top: 8px;"><strong>Status:</strong> This plug meets regulatory requirements. The barrier is approved for permanent abandonment.</p>
                    <p style="margin-top: 8px;"><strong>Next Steps:</strong> Document results, submit to regulatory authority, proceed with next barrier.</p>
                `;
                bgColor = 'rgba(34, 197, 94, 0.1)';
                borderColor = 'var(--success)';
            } else if (dropPercentage <= 5) {
                // Borderline
                status = 'âš ï¸ TEST QUESTIONABLE';
                message = `
                    <p><strong>Result:</strong> Pressure dropped from ${targetPressure} PSI to ${Math.round(finalPressure)} PSI (${dropPercentage.toFixed(1)}% loss).</p>
                    <p style="margin-top: 8px;"><strong>Status:</strong> Minor leakage detected. May require remediation depending on regulations.</p>
                    <p style="margin-top: 8px;"><strong>Recommended Action:</strong> Consult engineer. Consider squeeze cementing or re-test with longer duration.</p>
                `;
                bgColor = 'rgba(234, 179, 8, 0.1)';
                borderColor = 'var(--warning)';
            } else {
                // Fail
                status = 'âŒ TEST FAILED';
                message = `
                    <p><strong>Result:</strong> Significant pressure loss from ${targetPressure} PSI to ${Math.round(finalPressure)} PSI (${dropPercentage.toFixed(1)}% drop).</p>
                    <p style="margin-top: 8px;"><strong>Status:</strong> Barrier has failed integrity test. NOT approved for abandonment.</p>
                    <p style="margin-top: 8px;"><strong>Required Action:</strong> Remediate plug immediately:</p>
                    <ul style="margin-left: 20px; margin-top: 4px;">
                        <li>Perforate plug at leak zone</li>
                        <li>Squeeze additional cement</li>
                        <li>Re-test until passing</li>
                        <li>Document all remediation work</li>
                    </ul>
                    <p style="margin-top: 8px;"><strong>Cost Impact:</strong> Failed tests typically add $50K-$200K in remediation costs and 1-2 weeks delay.</p>
                `;
                bgColor = 'rgba(239, 68, 68, 0.1)';
                borderColor = 'var(--danger)';
            }

            results.innerHTML = `
                <h5 style="margin-bottom: 12px; color: ${borderColor};">${status}</h5>
                ${message}
            `;
            results.style.background = bgColor;
            results.style.borderLeft = `4px solid ${borderColor}`;
            results.style.display = 'block';

            // Re-enable start button
            document.getElementById('start-test-btn').disabled = false;
        }

        function resetPressureTest() {
            // Clear interval
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
            }

            // Reset UI
            document.getElementById('current-pressure').textContent = '0';
            document.getElementById('pressure-arrows').style.display = 'none';
            document.getElementById('test-progress').style.display = 'none';
            document.getElementById('progress-fill').style.width = '0%';
            document.getElementById('progress-time').textContent = '0%';
            document.getElementById('cement-plug').classList.remove('under-pressure');
            document.getElementById('leak-indicators').innerHTML = '';
            document.getElementById('test-results').style.display = 'none';
            document.getElementById('start-test-btn').disabled = false;
        }

        // Cost Breakdown Pie Chart (Module 6)
        function selectCostCategory(category) {
            const details = document.getElementById('cost-details');
            const categoryData = {
                'equipment': {
                    title: 'ðŸ—ï¸ Equipment Rental (30% of Total Cost)',
                    percentage: '30%',
                    typical: '$90K - $900K',
                    description: 'Specialized equipment rental is typically the largest P&A expense.',
                    breakdown: [
                        '<strong>Wireline Units:</strong> $5K-$15K/day - Setting bridge plugs, running logs',
                        '<strong>Coiled Tubing:</strong> $8K-$25K/day - Milling, cleanout, cement placement',
                        '<strong>Workover Rigs:</strong> $10K-$50K/day - Heavy lifting, casing removal',
                        '<strong>Cement Units:</strong> $3K-$8K/day - Mixing and pumping cement',
                        '<strong>Support Equipment:</strong> Trucks, tanks, power units, safety equipment'
                    ],
                    notes: 'Deep or complex wells may require multiple equipment types simultaneously, significantly increasing daily costs.'
                },
                'labor': {
                    title: 'ðŸ‘· Labor & Personnel (25% of Total Cost)',
                    percentage: '25%',
                    typical: '$75K - $750K',
                    description: 'Skilled specialists required for safe, compliant P&A operations.',
                    breakdown: [
                        '<strong>Wireline Operators:</strong> Specialized certification required',
                        '<strong>Cement Engineers:</strong> Design plugs, supervise placement',
                        '<strong>Rig Crew:</strong> Operators, derrickmen, roughnecks (5-10 personnel)',
                        '<strong>Supervisors:</strong> Company man, toolpusher overseeing operations',
                        '<strong>Safety Personnel:</strong> H2S monitors, fire watch, safety coordinators',
                        '<strong>Consultants:</strong> Wellbore integrity, regulatory compliance experts'
                    ],
                    notes: 'Offshore operations require crew rotation, transportation, accommodations - adding 30-50% to labor costs.'
                },
                'materials': {
                    title: 'ðŸ—ï¸ Cement & Materials (20% of Total Cost)',
                    percentage: '20%',
                    typical: '$60K - $600K',
                    description: 'High-quality materials ensure permanent sealing.',
                    breakdown: [
                        '<strong>Cement:</strong> Class H cement, additives, retarders ($15-$30/sack Ã— hundreds of sacks)',
                        '<strong>Bridge Plugs:</strong> Mechanical barriers ($5K-$50K each)',
                        '<strong>Completion Fluids:</strong> Kill fluids, spacers, wash fluids',
                        '<strong>Casing Patches:</strong> For casing repairs if needed',
                        '<strong>Consumables:</strong> Chemicals, lubricants, misc supplies'
                    ],
                    notes: 'Material costs scale directly with well depth and number of barriers. Deep wells requiring multiple cement plugs can consume 500+ sacks.'
                },
                'testing': {
                    title: 'ðŸ§ª Testing & Monitoring (10% of Total Cost)',
                    percentage: '10%',
                    typical: '$30K - $300K',
                    description: 'Mandatory verification ensures barrier integrity.',
                    breakdown: [
                        '<strong>Pressure Testing:</strong> Each barrier must pass pressure test',
                        '<strong>Cement Bond Logs:</strong> Verify cement quality and bonding',
                        '<strong>Temperature Logs:</strong> Confirm cement placement locations',
                        '<strong>Radioactive Tracer:</strong> Detect cement top and channels',
                        '<strong>Monitoring:</strong> Environmental monitoring during operations'
                    ],
                    notes: 'Testing cannot be skipped - failed tests require costly remediation and re-testing until barriers pass.'
                },
                'mobilization': {
                    title: 'ðŸšš Mobilization & Logistics (10% of Total Cost)',
                    percentage: '10%',
                    typical: '$30K - $300K',
                    description: 'Moving equipment and personnel to/from well site.',
                    breakdown: [
                        '<strong>Rig Mobilization:</strong> Transporting workover rig to location',
                        '<strong>Equipment Transport:</strong> Multiple trucks for wireline, coiled tubing, cement',
                        '<strong>Road Construction:</strong> Access roads for remote locations',
                        '<strong>Offshore Logistics:</strong> Boats, helicopters, platform preparation',
                        '<strong>Demobilization:</strong> Removal and site restoration after completion'
                    ],
                    notes: 'Offshore and remote locations can see mobilization costs exceed 20% of total. Ultra-deep water mobilization may cost $1M+.'
                },
                'regulatory': {
                    title: 'ðŸ“‹ Regulatory & Permitting (5% of Total Cost)',
                    percentage: '5%',
                    typical: '$15K - $150K',
                    description: 'Compliance, permitting, bonding, and documentation.',
                    breakdown: [
                        '<strong>Permits:</strong> State/federal abandonment permits, environmental permits',
                        '<strong>Engineering Studies:</strong> P&A plan development and submission',
                        '<strong>Bonding:</strong> Financial assurance posting (refundable)',
                        '<strong>Inspections:</strong> Third-party verification, regulatory witness',
                        '<strong>Documentation:</strong> Final abandonment report, as-built diagrams',
                        '<strong>Legal/Consulting:</strong> Regulatory compliance experts'
                    ],
                    notes: 'While smallest percentage, non-compliance can result in operations shutdown and penalties exceeding $100K/day.'
                }
            };

            const data = categoryData[category];
            if (!data) return;

            let html = `
                <h4 style="margin-bottom: 16px; color: var(--accent);">${data.title}</h4>
                <div style="display: flex; justify-content: space-between; margin-bottom: 16px; padding: 12px; background: rgba(20, 184, 166, 0.1); border-radius: 8px;">
                    <div>
                        <div style="font-size: 0.85rem; color: var(--muted);">Percentage of Total</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent);">${data.percentage}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.85rem; color: var(--muted);">Typical Range</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--text-primary);">${data.typical}</div>
                    </div>
                </div>
                <p style="margin-bottom: 16px; line-height: 1.6;">${data.description}</p>
                <div style="background: var(--bg); padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h5 style="margin-bottom: 12px; color: var(--text-primary);">Breakdown:</h5>
                    <ul style="margin-left: 20px; line-height: 2;">
                        ${data.breakdown.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                </div>
                <div style="padding: 12px; background: rgba(234, 179, 8, 0.1); border-radius: 6px; border-left: 3px solid var(--warning);">
                    <p style="font-size: 0.9rem;"><strong>ðŸ’¡ Note:</strong> ${data.notes}</p>
                </div>
            `;

            details.innerHTML = html;
            details.style.animation = 'fadeInUp 0.5s ease';
        }

        // Reset Course Progress
        function resetCourseProgress() {
            if (confirm('âš ï¸ Are you sure you want to reset all course progress?\n\nThis will:\nâ€¢ Clear all completed modules\nâ€¢ Reset video checkpoint progress\nâ€¢ Lock all modules (must watch video)\nâ€¢ Remove your certificate\nâ€¢ Reset all quiz answers\nâ€¢ Start the course from the beginning\n\nThis action cannot be undone!')) {
                // Clear localStorage
                localStorage.removeItem('pa-course-progress');
                localStorage.removeItem('pa-course-certificate');

                // Show success message
                alert('âœ… Course progress has been reset successfully!\n\nThe page will now reload. Remember to watch the video to unlock modules!');

                // Reload the page
                window.location.reload();
            }
        }

        // Environmental Risk Visualizer (Module 1)
        function selectRisk(risk) {
            // Remove all active states
            document.querySelectorAll('.risk-card').forEach(card => {
                card.classList.remove('active');
                card.style.animation = '';
            });
            document.querySelectorAll('.risk-details').forEach(detail => detail.classList.remove('active'));

            // Activate selected risk with animation
            const card = document.querySelector(`[data-risk="${risk}"]`);
            if (card) {
                card.classList.add('active');
                card.style.animation = 'cardFlip 0.6s ease';

                const detail = document.getElementById(`risk-${risk}`);
                detail.classList.add('active');
                detail.style.animation = 'fadeInUp 0.5s ease';

                // Enable continue button
                enableContinue();
            }
        }

        // Three Golden Rules (Module 7)
        function selectGoldenRule(ruleNum) {
            // Remove all active states
            document.querySelectorAll('.golden-rule-card').forEach(card => {
                card.classList.remove('active');
                card.style.animation = '';
            });
            document.querySelectorAll('.rule-application').forEach(app => app.classList.remove('active'));

            // Activate selected rule with animation
            const card = document.querySelector(`[data-rule="${ruleNum}"]`);
            if (card) {
                card.classList.add('active');
                card.style.animation = 'bounce 0.5s ease';

                const app = document.getElementById(`rule-app-${ruleNum}`);
                app.classList.add('active');
                app.style.animation = 'slideInLeft 0.5s ease';

                // Enable continue button
                enableContinue();
            }
        }

        // Regulatory Comparison Tool
        function selectRegulation(type) {
            // Remove all selected states
            document.querySelectorAll('.reg-card').forEach(card => {
                card.classList.remove('selected');
                card.style.animation = '';
            });
            document.querySelectorAll('.reg-details').forEach(detail => detail.classList.remove('active'));

            // Select clicked card with animation
            const card = document.querySelector(`[data-reg="${type}"]`);
            if (card) {
                card.classList.add('selected');
                card.style.animation = 'successPulse 0.5s ease';

                const detail = document.getElementById(`reg-details-${type}`);
                detail.classList.add('active');
                detail.style.animation = 'slideInRight 0.5s ease';

                // Enable continue button after interaction
                enableContinue();
            }
        }

        // Global Standards Explorer
        function exploreCountry(country) {
            // Toggle active state
            document.querySelectorAll('.country-card').forEach(card => {
                if (card.dataset.country === country) {
                    card.classList.toggle('active');
                    card.style.animation = 'bounce 0.5s ease';
                } else {
                    card.classList.remove('active');
                    card.style.animation = '';
                }
            });

            // Show country details
            const details = document.getElementById(`country-details-${country}`);
            if (details) {
                const isActive = details.classList.contains('active');
                document.querySelectorAll('.country-details').forEach(d => d.classList.remove('active'));
                if (!isActive) {
                    details.classList.add('active');
                    details.style.animation = 'fadeInUp 0.5s ease';

                    // Enable continue button after exploring a country
                    enableContinue();
                }
            }
        }

        // Barrier Builder - Drag and Drop
        let draggedComponent = null;

        function allowDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.add('drag-over');
        }

        function clearDragOver(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function drag(event) {
            draggedComponent = {
                type: event.target.dataset.type,
                name: event.target.dataset.name
            };
            event.target.classList.add('dragging');
        }

        function dragEnd(event) {
            event.target.classList.remove('dragging');
        }

        function drop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('drag-over');

            const layer = event.currentTarget;
            const requiredType = layer.dataset.type;

            if (draggedComponent && draggedComponent.type === requiredType) {
                layer.classList.add('filled', requiredType);
                layer.innerHTML = `<strong>${draggedComponent.name}</strong><br><small>âœ“ Correctly placed</small>`;

                // Add visual feedback for successful drop
                layer.style.animation = 'bounce 0.5s ease';
                layer.style.boxShadow = '0 0 20px rgba(34, 197, 94, 0.6)';

                checkBarrierComplete();
            } else {
                // Visual feedback for incorrect drop
                layer.style.animation = 'shake 0.5s ease';
                setTimeout(() => {
                    layer.style.animation = '';
                }, 500);
                alert(`This layer requires: ${requiredType}. You dragged: ${draggedComponent.type}`);
            }
        }

        function checkBarrierComplete() {
            const layers = document.querySelectorAll('.barrier-layer');
            const allFilled = Array.from(layers).every(layer => layer.classList.contains('filled'));

            if (allFilled) {
                const result = document.getElementById('barrier-result');
                if (result) {
                    result.style.display = 'block';
                    result.innerHTML = '<strong style="color: var(--success);">âœ“ Barrier Complete!</strong><p>You have successfully designed a proper P&A barrier with all three essential components in the correct sequence.</p>';
                    result.style.animation = 'fadeInUp 0.5s ease';

                    // Visual celebration for completing barrier
                    createConfetti();

                    // Animate the barrier layers
                    layers.forEach((layer, index) => {
                        setTimeout(() => {
                            layer.style.animation = 'successPulse 0.5s ease';
                        }, index * 100);
                    });

                    // Enable continue button after completing barrier
                    enableContinue();
                }
            }
        }

        function resetBarrier() {
            document.querySelectorAll('.barrier-layer').forEach(layer => {
                layer.classList.remove('filled', 'cement', 'casing', 'formation');
                layer.innerHTML = `Drop ${layer.dataset.type} here`;
            });
            const result = document.getElementById('barrier-result');
            if (result) result.style.display = 'none';
        }

        // Financial Calculator
        function calculatePABond() {
            const depth = parseFloat(document.getElementById('well-depth').value) || 0;
            const complexity = parseFloat(document.getElementById('complexity').value) || 1;
            const location = document.getElementById('location').value;

            // Base calculation (simplified for educational purposes)
            let baseCost = depth * 50; // $50 per foot base rate

            // Complexity multiplier
            baseCost *= complexity;

            // Location factor
            const locationFactors = {
                'onshore': 1.0,
                'shallow-water': 1.5,
                'deep-water': 2.5,
                'ultra-deep': 4.0
            };
            baseCost *= locationFactors[location] || 1.0;

            // Display results
            document.getElementById('bond-amount').textContent =
                '$' + baseCost.toLocaleString('en-US', {maximumFractionDigits: 0});

            // Update slider display
            document.getElementById('complexity-value').textContent =
                complexity === 1 ? 'Low' : complexity === 2 ? 'Medium' : 'High';

            // Enable continue button after calculation
            enableContinue();
        }

        // Liability Timeline Interaction
        function highlightTimelineItem(year) {
            document.querySelectorAll('.timeline-item').forEach(item => {
                if (item.dataset.year === year.toString()) {
                    item.style.background = 'rgba(20, 184, 166, 0.1)';
                    item.style.transform = 'translateX(8px)';
                } else {
                    item.style.background = 'var(--bg-white)';
                    item.style.transform = 'translateX(4px)';
                }
            });

            // Enable continue button after clicking timeline items
            enableContinue();
        }
    </script>
</body>
</html>
