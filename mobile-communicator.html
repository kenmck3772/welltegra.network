<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Mobile Communicator | WellTegra</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Mobile-first touch optimizations */
        button, input, textarea {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Card styles */
        .card {
            background: rgba(30, 41, 59, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            backdrop-filter: blur(10px);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* Button styles */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: all 0.2s;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            transition: all 0.2s;
        }

        .btn-danger:active {
            transform: scale(0.98);
        }

        /* Input styles */
        .input-field {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.5);
            transition: all 0.2s;
        }

        .input-field:focus {
            background: rgba(15, 23, 42, 0.8);
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* List item styles */
        .request-item {
            transition: all 0.2s;
        }

        .request-item:active {
            transform: scale(0.98);
        }

        /* Badge styles */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .badge-approved {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .badge-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(71, 85, 105, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(71, 85, 105, 0.7);
        }
    </style>
</head>
<body class="text-white">
    <div id="mobile-communicator" class="min-h-screen">
        <!-- Header -->
        <header class="sticky top-0 z-50 bg-slate-900/95 backdrop-blur-sm border-b border-slate-700/50">
            <div class="px-4 py-4">
                <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <button id="close-mobile-communicator" onclick="window.location.href='index.html'" class="text-slate-400 hover:text-white transition">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <div>
                            <h1 class="text-xl font-bold text-white flex items-center gap-2">
                                <i class="fas fa-mobile-alt text-cyan-400"></i>
                                Mobile Communicator
                            </h1>
                            <p class="text-xs text-slate-400">Remote Approvals & Sign-offs</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-slate-400">Last Sync</p>
                        <p id="communicator-last-sync" class="text-sm font-semibold text-cyan-400">--:--</p>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="px-4 py-6 space-y-6 pb-24">
            <!-- Statistics Cards -->
            <section>
                <div class="grid grid-cols-3 gap-3">
                    <div class="card stat-card p-4">
                        <div class="text-center">
                            <p class="text-xs text-slate-400 mb-1">Total</p>
                            <p id="communicator-summary-total" class="text-2xl font-bold text-white">0</p>
                        </div>
                    </div>
                    <div class="card stat-card p-4">
                        <div class="text-center">
                            <p class="text-xs text-slate-400 mb-1">Pending</p>
                            <p id="communicator-summary-pending" class="text-2xl font-bold text-amber-400">0</p>
                        </div>
                    </div>
                    <div class="card stat-card p-4">
                        <div class="text-center">
                            <p class="text-xs text-slate-400 mb-1">Approved</p>
                            <p id="communicator-summary-approved" class="text-2xl font-bold text-emerald-400">0</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Request List -->
            <section class="card p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-white flex items-center gap-2">
                        <i class="fas fa-clipboard-list text-blue-400"></i>
                        Change Requests
                    </h2>
                    <button class="text-sm text-cyan-400 hover:text-cyan-300 transition">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>

                <!-- Empty State -->
                <div id="communicator-empty" class="hidden text-center py-8">
                    <i class="fas fa-inbox text-4xl text-slate-600 mb-3"></i>
                    <p class="text-slate-400 text-sm">No pending requests</p>
                </div>

                <!-- Request List -->
                <ul id="communicator-request-list" class="space-y-2">
                    <!-- Populated by JS -->
                </ul>
            </section>

            <!-- Request Details (Hidden by default) -->
            <section class="card p-4 hidden" id="communicator-detail-section">
                <h3 class="text-lg font-semibold text-white mb-3">Request Details</h3>
                <div class="space-y-2 text-sm">
                    <div>
                        <span class="text-slate-400">Status:</span>
                        <span id="communicator-detail-status" class="ml-2 text-white font-semibold"></span>
                    </div>
                    <div>
                        <span class="text-slate-400">Category:</span>
                        <span id="communicator-detail-category" class="ml-2 text-white font-semibold"></span>
                    </div>
                </div>
            </section>

            <!-- Sign-off Form -->
            <section class="card p-4">
                <h2 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-signature text-purple-400"></i>
                    Remote Sign-off
                </h2>

                <form id="communicator-signoff-form" class="space-y-4">
                    <!-- Email Input -->
                    <div>
                        <label for="communicator-email" class="block text-sm font-medium text-slate-300 mb-2">
                            Email Address
                        </label>
                        <input
                            type="email"
                            id="communicator-email"
                            class="input-field w-full px-4 py-3 rounded-lg text-white"
                            placeholder="supervisor@example.com"
                            required
                            autocomplete="email"
                        >
                    </div>

                    <!-- PIN Input -->
                    <div>
                        <label for="communicator-pin" class="block text-sm font-medium text-slate-300 mb-2">
                            PIN Code
                        </label>
                        <input
                            type="password"
                            id="communicator-pin"
                            class="input-field w-full px-4 py-3 rounded-lg text-white font-mono"
                            placeholder="Enter 4-digit PIN"
                            pattern="[0-9]*"
                            inputmode="numeric"
                            maxlength="6"
                            required
                        >
                    </div>

                    <!-- Comment Input -->
                    <div>
                        <label for="communicator-comment" class="block text-sm font-medium text-slate-300 mb-2">
                            Comments (Optional)
                        </label>
                        <textarea
                            id="communicator-comment"
                            class="input-field w-full px-4 py-3 rounded-lg text-white resize-none"
                            rows="3"
                            placeholder="Add any additional notes..."
                        ></textarea>
                    </div>

                    <!-- Feedback Message -->
                    <div id="communicator-feedback" class="text-sm"></div>

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-2 gap-3 pt-2">
                        <button
                            type="button"
                            data-decision="approve"
                            class="btn-primary w-full py-3 rounded-lg font-semibold text-white flex items-center justify-center gap-2"
                        >
                            <i class="fas fa-check"></i>
                            Approve
                        </button>
                        <button
                            type="button"
                            data-decision="reject"
                            class="btn-danger w-full py-3 rounded-lg font-semibold text-white flex items-center justify-center gap-2"
                        >
                            <i class="fas fa-times"></i>
                            Reject
                        </button>
                    </div>
                </form>
            </section>

            <!-- Activity Feed -->
            <section class="card p-4">
                <h2 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-history text-green-400"></i>
                    Recent Activity
                </h2>

                <!-- Empty State -->
                <div id="communicator-feed-empty" class="text-center py-6">
                    <i class="fas fa-clock text-3xl text-slate-600 mb-2"></i>
                    <p class="text-slate-400 text-sm">No activity yet</p>
                </div>

                <!-- Activity Feed -->
                <ul id="communicator-feed" class="space-y-3 text-sm">
                    <!-- Populated by JS -->
                </ul>
            </section>
        </main>

        <!-- Bottom Info Bar -->
        <footer class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-sm border-t border-slate-700/50 px-4 py-3">
            <div class="flex items-center justify-between text-xs text-slate-400">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></span>
                    <span>Connected</span>
                </div>
                <div>
                    <i class="fas fa-shield-alt text-cyan-400"></i>
                    <span class="ml-1">Secure Connection</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="assets/js/auth.js"></script>
    <script src="assets/js/sync-status.js"></script>
    <script src="assets/js/mobile-communicator.js"></script>

    <script>
        // Authentication check
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.AuthManager || !window.AuthManager.isAuthenticated()) {
                window.location.href = '/index.html';
                return;
            }

            // Mobile-specific optimizations
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            if (isStandalone) {
                console.log('[MobileCommunicator] Running in standalone mode');
            }

            // Prevent pull-to-refresh on mobile
            let startY = 0;
            document.addEventListener('touchstart', (e) => {
                startY = e.touches[0].pageY;
            }, { passive: true });

            document.addEventListener('touchmove', (e) => {
                const y = e.touches[0].pageY;
                if (window.scrollY === 0 && y > startY) {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>
