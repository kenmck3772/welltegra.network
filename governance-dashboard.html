<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Brahan Engine - Governance & Mission Control Dashboard</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============================================
        // API CONFIGURATION
        // ============================================
        const API_BASE_URL = 'https://brahan-engine-api-ikldvpsusa-nw.a.run.app';

        // API Helper Functions
        const api = {
          async getTelemetry() {
            const response = await fetch(`${API_BASE_URL}/api/telemetry/current`);
            return response.json();
          },

          async getTeamStatus() {
            const response = await fetch(`${API_BASE_URL}/api/team/status`);
            return response.json();
          },

          async getConflicts() {
            const response = await fetch(`${API_BASE_URL}/api/conflicts`);
            return response.json();
          },

          async getAlerts(limit = 10) {
            const response = await fetch(`${API_BASE_URL}/api/alerts?limit=${limit}`);
            return response.json();
          },

          async resolveConflict(conflictId, resolution) {
            const response = await fetch(`${API_BASE_URL}/api/conflicts/${conflictId}/resolve`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ resolution })
            });
            return response.json();
          },

          async createConflict(conflict) {
            const response = await fetch(`${API_BASE_URL}/api/conflicts/create`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(conflict)
            });
            return response.json();
          }
        };

        // Lucide Icon Components
        const Icon = ({ name, className = '', size = 24, ...props }) => {
            const iconRef = React.useRef(null);

            useEffect(() => {
                if (iconRef.current) {
                    const iconElement = lucide.createElement(name);
                    iconRef.current.innerHTML = '';
                    iconRef.current.appendChild(iconElement);
                }
            }, [name]);

            return <span ref={iconRef} className={className} {...props} />;
        };

        // ============================================
        // MOCK DATA (Fallback for conflict scenarios)
        // ============================================
        const CONFLICT_SCENARIOS = [
          {
            id: 'ct-packoff-vs-rop',
            title: 'Coiled Tubing Pack-off Risk vs. ROP Target',
            description: 'AI recommends 120 ft/hr ROP, but CT specialist flags pack-off risk at 90+ ft/hr',
            specialists: ['Maria Rodriguez', 'Priya Sharma'],
            ai_recommendation: 'ROP: 120 ft/hr (Performance KPI)',
            safety_override: 'ROP: 85 ft/hr (Safety First)',
            risk_score: 7.2,
            performance_impact: '-29% ROP',
            resolved: false
          },
          {
            id: 'pressure-anomaly',
            title: 'Pressure Anomaly Detection - AI vs. Human',
            description: 'ML model flags 2% pressure deviation as normal, Drilling Supervisor requests investigation',
            specialists: ['Lars Andersen', 'Priya Sharma'],
            ai_recommendation: 'Continue operations (98% confidence)',
            safety_override: 'Pause & investigate pressure trend',
            risk_score: 5.8,
            performance_impact: '-2 hrs downtime',
            resolved: false
          }
        ];

        // ============================================
        // RADIAL GAUGE COMPONENT
        // ============================================
        const RadialGauge = ({ score, size = 180 }) => {
          const radius = size / 2 - 10;
          const circumference = 2 * Math.PI * radius;
          const offset = circumference - (score / 100) * circumference;

          const getColor = () => {
            if (score >= 80) return '#3b82f6'; // Electric Blue
            if (score >= 60) return '#f59e0b'; // Amber
            return '#ef4444'; // Red
          };

          return (
            <div className="relative" style={{ width: size, height: size }}>
              <svg className="transform -rotate-90" width={size} height={size}>
                {/* Background circle */}
                <circle
                  cx={size / 2}
                  cy={size / 2}
                  r={radius}
                  stroke="#1e293b"
                  strokeWidth="12"
                  fill="none"
                />
                {/* Progress circle */}
                <circle
                  cx={size / 2}
                  cy={size / 2}
                  r={radius}
                  stroke={getColor()}
                  strokeWidth="12"
                  fill="none"
                  strokeDasharray={circumference}
                  strokeDashoffset={offset}
                  strokeLinecap="round"
                  className="transition-all duration-1000"
                  style={{ filter: 'drop-shadow(0 0 8px ' + getColor() + ')' }}
                />
              </svg>
              <div className="absolute inset-0 flex flex-col items-center justify-center">
                <div className="text-4xl font-bold" style={{ color: getColor() }}>
                  {Math.round(score)}
                </div>
                <div className="text-xs text-slate-400 uppercase tracking-wider">DCI Score</div>
              </div>
            </div>
          );
        };

        // ============================================
        // MAIN DASHBOARD COMPONENT
        // ============================================
        const DashboardApp = () => {
          // State Management
          const [dciScore, setDciScore] = useState(85);
          const [telemetryLatency, setTelemetryLatency] = useState(420);
          const [hseVetoLocked, setHseVetoLocked] = useState(false);
          const [operationalMode, setOperationalMode] = useState('AI_DRIVEN');
          const [activeConflicts, setActiveConflicts] = useState([]);
          const [teamStatuses, setTeamStatuses] = useState([]);
          const [executionEnabled, setExecutionEnabled] = useState(true);
          const [systemAlerts, setSystemAlerts] = useState([]);
          const [apiStatus, setApiStatus] = useState('connecting');

          // ============================================
          // LIVE API DATA FETCHING
          // ============================================

          // Fetch telemetry data from API
          const fetchTelemetry = async () => {
            try {
              const data = await api.getTelemetry();
              setDciScore(data.score);
              setTelemetryLatency(data.latency);
              setOperationalMode(data.operational_mode);
              setApiStatus('connected');
            } catch (error) {
              console.error('Failed to fetch telemetry:', error);
              setApiStatus('disconnected');
            }
          };

          // Fetch team status from API
          const fetchTeamStatus = async () => {
            try {
              const data = await api.getTeamStatus();
              setTeamStatuses(data);
            } catch (error) {
              console.error('Failed to fetch team status:', error);
            }
          };

          // Fetch conflicts from API
          const fetchConflicts = async () => {
            try {
              const data = await api.getConflicts();
              setActiveConflicts(data);
            } catch (error) {
              console.error('Failed to fetch conflicts:', error);
            }
          };

          // Fetch alerts from API
          const fetchAlerts = async () => {
            try {
              const data = await api.getAlerts(10);
              setSystemAlerts(data);
            } catch (error) {
              console.error('Failed to fetch alerts:', error);
            }
          };

          // Initial data fetch on component mount
          useEffect(() => {
            fetchTelemetry();
            fetchTeamStatus();
            fetchConflicts();
            fetchAlerts();
          }, []);

          // Poll telemetry data every 3 seconds
          useEffect(() => {
            const interval = setInterval(() => {
              fetchTelemetry();
            }, 3000);

            return () => clearInterval(interval);
          }, []);

          // Poll conflicts every 10 seconds
          useEffect(() => {
            const interval = setInterval(() => {
              fetchConflicts();
            }, 10000);

            return () => clearInterval(interval);
          }, []);

          // Poll alerts every 5 seconds
          useEffect(() => {
            const interval = setInterval(() => {
              fetchAlerts();
            }, 5000);

            return () => clearInterval(interval);
          }, []);

          // ============================================
          // EXECUTION GATEKEEPER LOGIC
          // ============================================
          useEffect(() => {
            const canExecute =
              dciScore >= 60 &&
              telemetryLatency < 1500 &&
              !hseVetoLocked &&
              activeConflicts.filter(c => !c.resolved).length === 0;

            setExecutionEnabled(canExecute);
          }, [dciScore, telemetryLatency, hseVetoLocked, activeConflicts]);

          // ============================================
          // CONFLICT RESOLUTION HANDLERS
          // ============================================
          const resolveConflict = async (conflictId, resolution) => {
            try {
              await api.resolveConflict(conflictId, resolution);

              // Update local state
              setActiveConflicts(prev =>
                prev.map(conflict =>
                  conflict.id === conflictId
                    ? { ...conflict, resolved: true, chosen_resolution: resolution }
                    : conflict
                )
              );

              // Refresh conflicts and alerts after resolution
              setTimeout(() => {
                fetchConflicts();
                fetchAlerts();
              }, 1000);
            } catch (error) {
              console.error('Failed to resolve conflict:', error);
            }
          };

          const toggleHSEVeto = () => {
            setHseVetoLocked(!hseVetoLocked);

            // Create alert for HSE veto state change
            const alertMessage = hseVetoLocked
              ? 'HSE Veto Released - Operations Enabled'
              : 'HSE VETO ACTIVATED - All Operations Halted';

            setSystemAlerts(alerts => [
              {
                id: Date.now(),
                type: hseVetoLocked ? 'success' : 'critical',
                message: alertMessage,
                timestamp: new Date().toLocaleTimeString()
              },
              ...alerts
            ]);
          };

          // Simulate conflict creation (for demo purposes)
          const triggerDemoConflict = async () => {
            if (activeConflicts.length >= 2) return;

            const availableScenarios = CONFLICT_SCENARIOS.filter(
              scenario => !activeConflicts.find(c => c.id === scenario.id)
            );

            if (availableScenarios.length > 0) {
              const newConflict = availableScenarios[0];
              try {
                await api.createConflict(newConflict);
                fetchConflicts();
                fetchAlerts();
              } catch (error) {
                console.error('Failed to create conflict:', error);
              }
            }
          };

          // ============================================
          // RENDER
          // ============================================
          return (
            <div className="min-h-screen bg-slate-950 text-slate-100 p-6">
              {/* Header */}
              <header className="mb-8 border-b border-slate-800 pb-6">
                <div className="flex items-center justify-between">
                  <div>
                    <h1 className="text-3xl font-bold text-blue-400 flex items-center gap-3">
                      <Icon name="terminal" className="w-8 h-8" />
                      The Brahan Engine
                    </h1>
                    <p className="text-slate-400 mt-1">Governance & Mission Control Dashboard</p>
                  </div>
                  <div className="flex items-center gap-4">
                    <div className="text-right">
                      <div className="text-sm text-slate-400">Operational Mode</div>
                      <div className={`text-lg font-bold ${
                        operationalMode === 'AI_DRIVEN' ? 'text-blue-400' :
                        operationalMode === 'LOCAL_MODE' ? 'text-red-400' :
                        'text-amber-400'
                      }`}>
                        {operationalMode.replace('_', ' ')}
                      </div>
                    </div>
                    <div className={`w-3 h-3 rounded-full animate-pulse ${
                      apiStatus === 'connected' ? 'bg-green-400' : 'bg-red-400'
                    }`} style={{
                      boxShadow: `0 0 20px ${apiStatus === 'connected' ? '#22c55e' : '#ef4444'}`
                    }} />
                  </div>
                </div>
              </header>

              <div className="grid grid-cols-12 gap-6">
                {/* Left Column - Main Controls */}
                <div className="col-span-8 space-y-6">
                  {/* Safety Gateways Row */}
                  <div className="grid grid-cols-3 gap-4">
                    {/* DCI Monitor */}
                    <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                      <div className="flex items-center gap-2 mb-4">
                        <Icon name="gauge" className="w-5 h-5 text-blue-400" />
                        <h3 className="font-semibold text-slate-200">Data Confidence Index</h3>
                      </div>
                      <div className="flex flex-col items-center">
                        <RadialGauge score={dciScore} size={140} />
                        <div className="mt-4 text-center">
                          <div className="text-xs text-slate-400 mb-1">Trust Score</div>
                          <div className={`text-sm font-medium ${
                            dciScore >= 80 ? 'text-blue-400' :
                            dciScore >= 60 ? 'text-amber-400' :
                            'text-red-400'
                          }`}>
                            {dciScore >= 80 ? 'AI-Driven Operations' :
                             dciScore >= 60 ? 'Manual Override Advised' :
                             'Manual Override Required'}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Telemetry Heartbeat */}
                    <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                      <div className="flex items-center gap-2 mb-4">
                        <Icon name="activity" className="w-5 h-5 text-blue-400" />
                        <h3 className="font-semibold text-slate-200">Telemetry Heartbeat</h3>
                      </div>
                      <div className="flex flex-col items-center justify-center h-40">
                        <div className={`text-5xl font-bold mb-2 ${
                          telemetryLatency < 1000 ? 'text-blue-400' :
                          telemetryLatency < 1500 ? 'text-amber-400' :
                          'text-red-400'
                        }`}>
                          {Math.round(telemetryLatency)}
                        </div>
                        <div className="text-xs text-slate-400 uppercase tracking-wider mb-3">milliseconds</div>
                        {telemetryLatency > 1500 && (
                          <div className="flex items-center gap-2 text-red-400 text-sm animate-pulse">
                            <Icon name="alert-triangle" className="w-4 h-4" />
                            <span className="font-semibold">LOCAL MODE ACTIVE</span>
                          </div>
                        )}
                        <div className="flex items-center gap-2 mt-2">
                          <Icon name="radio" className={`w-4 h-4 ${telemetryLatency < 1500 ? 'text-blue-400 animate-pulse' : 'text-slate-600'}`} />
                          <span className="text-xs text-slate-400">
                            {telemetryLatency < 1500 ? 'Real-time sync' : 'Degraded link'}
                          </span>
                        </div>
                      </div>
                    </div>

                    {/* HSE Golden Red Switch */}
                    <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                      <div className="flex items-center gap-2 mb-4">
                        <Icon name="shield" className="w-5 h-5 text-blue-400" />
                        <h3 className="font-semibold text-slate-200">HSE Veto Authority</h3>
                      </div>
                      <div className="flex flex-col items-center justify-center h-40">
                        <button
                          onClick={toggleHSEVeto}
                          className={`relative w-32 h-32 rounded-full border-4 transition-all duration-300 ${
                            hseVetoLocked
                              ? 'border-red-500 bg-red-500/20 shadow-lg shadow-red-500/50'
                              : 'border-slate-700 bg-slate-800 hover:border-slate-600'
                          }`}
                        >
                          <Icon name={hseVetoLocked ? "lock" : "unlock"} className={`w-12 h-12 mx-auto ${hseVetoLocked ? 'text-red-400' : 'text-slate-400'}`} />
                        </button>
                        <div className={`mt-3 text-sm font-semibold ${
                          hseVetoLocked ? 'text-red-400' : 'text-slate-400'
                        }`}>
                          {hseVetoLocked ? 'VETO LOCKED' : 'Veto Available'}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Conflict Resolution Module */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center justify-between mb-4">
                      <div className="flex items-center gap-2">
                        <Icon name="alert-octagon" className="w-5 h-5 text-amber-400" />
                        <h3 className="font-semibold text-slate-200">Conflict Resolution Module</h3>
                      </div>
                      <div className="flex items-center gap-3">
                        <div className="text-sm text-slate-400">
                          Active Conflicts: <span className="text-amber-400 font-semibold">{activeConflicts.filter(c => !c.resolved).length}</span>
                        </div>
                        <button
                          onClick={triggerDemoConflict}
                          className="text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1 rounded"
                        >
                          Trigger Demo Conflict
                        </button>
                      </div>
                    </div>

                    {activeConflicts.length === 0 ? (
                      <div className="text-center py-12 text-slate-500">
                        <Icon name="check-circle-2" className="w-12 h-12 mx-auto mb-3 opacity-50" />
                        <p>No active conflicts - All systems nominal</p>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        {activeConflicts.map(conflict => (
                          <div
                            key={conflict.id}
                            className={`border rounded-lg p-4 transition-all ${
                              conflict.resolved
                                ? 'border-green-800 bg-green-950/30'
                                : 'border-amber-800 bg-amber-950/20'
                            }`}
                          >
                            <div className="flex items-start justify-between mb-3">
                              <div className="flex-1">
                                <h4 className="font-semibold text-slate-200 mb-1">{conflict.title}</h4>
                                <p className="text-sm text-slate-400">{conflict.description}</p>
                              </div>
                              {conflict.resolved && (
                                <Icon name="check-circle-2" className="w-5 h-5 text-green-400 ml-2" />
                              )}
                            </div>

                            <div className="grid grid-cols-2 gap-3 mb-3">
                              <div className="bg-slate-800 rounded p-3">
                                <div className="text-xs text-slate-400 mb-1">AI Recommendation</div>
                                <div className="text-sm text-blue-400 font-medium">{conflict.ai_recommendation}</div>
                              </div>
                              <div className="bg-slate-800 rounded p-3">
                                <div className="text-xs text-slate-400 mb-1">Safety Override</div>
                                <div className="text-sm text-amber-400 font-medium">{conflict.safety_override}</div>
                              </div>
                            </div>

                            <div className="flex items-center justify-between text-xs text-slate-400 mb-3">
                              <div className="flex items-center gap-4">
                                <span>Risk Score: <span className="text-red-400 font-semibold">{conflict.risk_score}/10</span></span>
                                <span>Performance Impact: <span className="text-amber-400 font-semibold">{conflict.performance_impact}</span></span>
                              </div>
                              <div className="flex items-center gap-2">
                                <Icon name="users" className="w-3 h-3" />
                                <span>{conflict.specialists.join(', ')}</span>
                              </div>
                            </div>

                            {!conflict.resolved && (
                              <div className="flex gap-2">
                                <button
                                  onClick={() => resolveConflict(conflict.id, 'safety')}
                                  className="flex-1 bg-amber-600 hover:bg-amber-700 text-white py-2 px-4 rounded font-medium transition-colors flex items-center justify-center gap-2"
                                >
                                  <Icon name="shield" className="w-4 h-4" />
                                  Apply Safety Override
                                </button>
                                <button
                                  onClick={() => resolveConflict(conflict.id, 'ai')}
                                  className="flex-1 bg-slate-700 hover:bg-slate-600 text-slate-200 py-2 px-4 rounded font-medium transition-colors flex items-center justify-center gap-2"
                                >
                                  <Icon name="zap" className="w-4 h-4" />
                                  Accept AI Recommendation
                                </button>
                              </div>
                            )}

                            {conflict.resolved && (
                              <div className="bg-green-900/30 border border-green-800 rounded p-2 text-sm text-green-400">
                                ✓ Resolved: {conflict.chosen_resolution === 'safety' ? 'Safety Override Applied' : 'AI Recommendation Accepted'}
                              </div>
                            )}
                          </div>
                        ))}
                      </div>
                    )}
                  </div>

                  {/* Execution Control */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <h3 className="font-semibold text-slate-200 mb-1">Execution Authorization</h3>
                        <p className="text-sm text-slate-400">All safety gateways must pass before execution</p>
                      </div>
                      <button
                        disabled={!executionEnabled}
                        className={`px-8 py-4 rounded-lg font-bold text-lg transition-all ${
                          executionEnabled
                            ? 'bg-blue-600 hover:bg-blue-700 text-white shadow-lg shadow-blue-500/50 cursor-pointer'
                            : 'bg-slate-800 text-slate-600 cursor-not-allowed'
                        }`}
                      >
                        {executionEnabled ? (
                          <span className="flex items-center gap-2">
                            <Icon name="check-circle-2" className="w-6 h-6" />
                            EXECUTE OPERATION
                          </span>
                        ) : (
                          <span className="flex items-center gap-2">
                            <Icon name="x-circle" className="w-6 h-6" />
                            EXECUTION BLOCKED
                          </span>
                        )}
                      </button>
                    </div>

                    {!executionEnabled && (
                      <div className="mt-4 p-3 bg-red-950/30 border border-red-900 rounded text-sm text-red-400">
                        <div className="font-semibold mb-2">Safety Gateways Failed:</div>
                        <ul className="space-y-1">
                          {dciScore < 60 && <li>• DCI Score below 60% threshold</li>}
                          {telemetryLatency >= 1500 && <li>• Telemetry latency exceeds 1500ms</li>}
                          {hseVetoLocked && <li>• HSE Veto Authority is locked</li>}
                          {activeConflicts.filter(c => !c.resolved).length > 0 && <li>• Unresolved specialist conflicts</li>}
                        </ul>
                      </div>
                    )}
                  </div>
                </div>

                {/* Right Column - Team & Alerts */}
                <div className="col-span-4 space-y-6">
                  {/* 11-Person Team Grid */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <Icon name="users" className="w-5 h-5 text-blue-400" />
                      <h3 className="font-semibold text-slate-200">Team Status</h3>
                    </div>
                    <div className="space-y-2 max-h-96 overflow-y-auto">
                      {teamStatuses.map(member => (
                        <div
                          key={member.id}
                          className={`p-3 rounded border ${
                            member.status === 'active' ? 'bg-slate-800 border-slate-700' :
                            member.status === 'vetoed' ? 'bg-red-950/30 border-red-900' :
                            'bg-slate-800/50 border-slate-700'
                          }`}
                        >
                          <div className="flex items-center justify-between">
                            <div className="flex-1">
                              <div className="font-medium text-slate-200 text-sm">{member.name}</div>
                              <div className="text-xs text-slate-400">{member.role}</div>
                            </div>
                            <div className="flex items-center gap-2">
                              <span className={`w-2 h-2 rounded-full ${
                                member.status === 'active' ? 'bg-green-400' :
                                member.status === 'vetoed' ? 'bg-red-400' :
                                'bg-amber-400'
                              }`} />
                              <span className="text-xs text-slate-400 capitalize">{member.status}</span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* System Alerts */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <Icon name="eye" className="w-5 h-5 text-blue-400" />
                      <h3 className="font-semibold text-slate-200">System Alerts</h3>
                    </div>
                    <div className="space-y-2 max-h-96 overflow-y-auto">
                      {systemAlerts.length === 0 ? (
                        <div className="text-center py-8 text-slate-500 text-sm">
                          No alerts - All systems nominal
                        </div>
                      ) : (
                        systemAlerts.map(alert => (
                          <div
                            key={alert.id}
                            className={`p-3 rounded text-sm border ${
                              alert.type === 'critical' ? 'bg-red-950/30 border-red-900 text-red-400' :
                              alert.type === 'warning' ? 'bg-amber-950/30 border-amber-900 text-amber-400' :
                              'bg-green-950/30 border-green-900 text-green-400'
                            }`}
                          >
                            <div className="flex items-start gap-2">
                              <Icon name={
                                alert.type === 'critical' ? 'alert-triangle' :
                                alert.type === 'warning' ? 'alert-octagon' :
                                'check-circle-2'
                              } className="w-4 h-4 flex-shrink-0 mt-0.5" />
                              <div className="flex-1">
                                <div className="font-medium">{alert.message}</div>
                                <div className="text-xs opacity-70 mt-1">{alert.timestamp}</div>
                              </div>
                            </div>
                          </div>
                        ))
                      )}
                    </div>
                  </div>

                  {/* API Status */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <Icon name="server" className="w-5 h-5 text-blue-400" />
                      <h3 className="font-semibold text-slate-200">Backend API</h3>
                    </div>
                    <div className="space-y-2 text-sm">
                      <div className="flex items-center justify-between">
                        <span className="text-slate-400">Status:</span>
                        <span className={`font-semibold ${apiStatus === 'connected' ? 'text-green-400' : 'text-red-400'}`}>
                          {apiStatus === 'connected' ? 'Connected' : 'Disconnected'}
                        </span>
                      </div>
                      <div className="flex items-center justify-between">
                        <span className="text-slate-400">Endpoint:</span>
                        <span className="text-blue-400 text-xs">Cloud Run</span>
                      </div>
                      <div className="mt-3 pt-3 border-t border-slate-800">
                        <a
                          href={`${API_BASE_URL}/health`}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-xs text-slate-400 hover:text-blue-400 underline break-all"
                        >
                          {API_BASE_URL}
                        </a>
                      </div>
                    </div>
                  </div>

                  {/* Safety Protocols Legend */}
                  <div className="bg-slate-900 border border-slate-800 rounded-lg p-6">
                    <div className="flex items-center gap-2 mb-4">
                      <Icon name="shield" className="w-5 h-5 text-blue-400" />
                      <h3 className="font-semibold text-slate-200">Remediation Protocols</h3>
                    </div>
                    <div className="space-y-3 text-sm">
                      <div className="p-2 bg-slate-800 rounded">
                        <div className="font-medium text-blue-400 mb-1">DCI Score Gateway</div>
                        <div className="text-xs text-slate-400">Validates data quality before AI-driven decisions</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded">
                        <div className="font-medium text-blue-400 mb-1">Heartbeat Signal</div>
                        <div className="text-xs text-slate-400">Ensures real-time connectivity for critical operations</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded">
                        <div className="font-medium text-blue-400 mb-1">HSE Veto Authority</div>
                        <div className="text-xs text-slate-400">Final safety override for all operational decisions</div>
                      </div>
                      <div className="p-2 bg-slate-800 rounded">
                        <div className="font-medium text-blue-400 mb-1">Risk-Weighted Matrix</div>
                        <div className="text-xs text-slate-400">Auto-prioritizes safety over performance KPIs</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Footer */}
              <footer className="mt-8 pt-6 border-t border-slate-800 text-center text-sm text-slate-500">
                <p>The Brahan Engine - Digital-First Offshore Intervention | Mission-Critical Governance Dashboard</p>
                <p className="mt-1 text-xs">Connected to live Cloud Run backend | Real-time data from Firestore</p>
              </footer>
            </div>
          );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DashboardApp />);
    </script>

    <!-- Initialize Lucide Icons -->
    <script>
        // Wait for icons to be ready
        setTimeout(() => {
            if (window.lucide) {
                lucide.createIcons();
            }
        }, 100);
    </script>
</body>
</html>
